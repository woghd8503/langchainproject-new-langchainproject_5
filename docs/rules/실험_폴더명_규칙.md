# ì‹¤í—˜ í´ë” ëª…ëª… ê·œì¹™

## ğŸ“‹ ê°œìš”

í”„ë¡œì íŠ¸ì—ì„œ ì½”ë“œë¥¼ ì‹¤í–‰í•˜ê³  ê²°ê³¼ë¬¼ì„ ì €ì¥í•  ë•ŒëŠ” **ë°˜ë“œì‹œ ì •í•´ì§„ í´ë” êµ¬ì¡°**ë¥¼ ë”°ë¼ì•¼ í•©ë‹ˆë‹¤.

ëª¨ë“  ì‹¤í—˜ ê²°ê³¼ë¬¼(ë¡œê·¸, ë‹µë³€, DB ê²°ê³¼, config ì„¤ì • ë“±)ì€ **ë™ì¼í•œ ì‹¤í—˜ í´ë”**ì— í•¨ê»˜ ì €ì¥ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.

---

## ğŸ¯ í•„ìˆ˜ í´ë” êµ¬ì¡°

### ê¸°ë³¸ í˜•ì‹
```
experiments/{ë‚ ì§œ}/{ë‚ ì§œ}_{ì‹œê°„}_{ì‹¤í—˜ëª…}/
```

### ì‹¤ì œ ì˜ˆì‹œ
```
experiments/20251028/20251028_143052_rag_vectordb_build/
```

---

## ğŸ“‚ í´ë” êµ¬ì¡° ìƒì„¸

```
experiments/
â””â”€â”€ 20251028/                                      # 1ë‹¨ê³„: ë‚ ì§œ í´ë” (YYYYMMDD)
    â”œâ”€â”€ 20251028_143052_rag_vectordb_build/       # 2ë‹¨ê³„: ë‚ ì§œ_ì‹œê°„_ì‹¤í—˜ëª…
    â”‚   â”œâ”€â”€ experiment.log                         # ë¡œê·¸ íŒŒì¼
    â”‚   â”œâ”€â”€ config.yaml                            # ì‹¤í–‰ ì‹œ ì‚¬ìš©í•œ ì„¤ì •
    â”‚   â”œâ”€â”€ vectordb/                              # VectorDB ê²°ê³¼
    â”‚   â”œâ”€â”€ results.json                           # ì‹¤í—˜ ê²°ê³¼
    â”‚   â””â”€â”€ outputs/                               # ìƒì„±ëœ ë‹µë³€ ë“±
    â”‚
    â”œâ”€â”€ 20251028_150823_agent_execution/          # ë‹¤ë¥¸ ì‹¤í—˜
    â”‚   â”œâ”€â”€ experiment.log
    â”‚   â”œâ”€â”€ config.yaml
    â”‚   â”œâ”€â”€ user_queries.txt
    â”‚   â”œâ”€â”€ responses.json
    â”‚   â””â”€â”€ tool_logs/
    â”‚
    â””â”€â”€ 20251028_163045_chatbot_evaluation/       # ë˜ ë‹¤ë¥¸ ì‹¤í—˜
        â”œâ”€â”€ experiment.log
        â”œâ”€â”€ config.yaml
        â”œâ”€â”€ test_questions.json
        â”œâ”€â”€ evaluation_results.json
        â””â”€â”€ screenshots/
```

---

## ğŸ’» ì‹¤í—˜ í´ë” ìƒì„± ë°©ë²•

### 1. ê¸°ë³¸ í…œí”Œë¦¿ (ëª¨ë“  ì½”ë“œì—ì„œ ì‚¬ìš©)

```python
import os
from datetime import datetime

# 1. ë‚ ì§œì™€ ì‹œê°„ ìƒì„±
today = datetime.now().strftime("%Y%m%d")        # "20251028"
time_now = datetime.now().strftime("%H%M%S")     # "143052"

# 2. ì‹¤í—˜ëª… ì •ì˜ (ì‘ì—… ë‚´ìš©ì— ë§ê²Œ)
experiment_name = "rag_vectordb_build"

# 3. ì‹¤í—˜ í´ë” ê²½ë¡œ ìƒì„±
experiment_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"
os.makedirs(experiment_dir, exist_ok=True)

# 4. ì´ì œ ì´ í´ë”ì— ëª¨ë“  ê²°ê³¼ë¬¼ ì €ì¥
print(f"ì‹¤í—˜ í´ë” ìƒì„±: {experiment_dir}")
```

### 2. í•˜ìœ„ í´ë” êµ¬ì¡° ì˜ˆì‹œ

```python
import os
from datetime import datetime

# ì‹¤í—˜ í´ë” ìƒì„±
today = datetime.now().strftime("%Y%m%d")
time_now = datetime.now().strftime("%H%M%S")
experiment_name = "chatbot_evaluation"
experiment_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"

# í•˜ìœ„ í´ë”ë“¤ ìƒì„±
os.makedirs(f"{experiment_dir}/outputs", exist_ok=True)      # ë‹µë³€ ê²°ê³¼
os.makedirs(f"{experiment_dir}/logs", exist_ok=True)         # ì¶”ê°€ ë¡œê·¸
os.makedirs(f"{experiment_dir}/configs", exist_ok=True)      # ì„¤ì • íŒŒì¼
os.makedirs(f"{experiment_dir}/data", exist_ok=True)         # ë°ì´í„° íŒŒì¼

print(f"ì‹¤í—˜ í´ë” ë° í•˜ìœ„ êµ¬ì¡° ìƒì„± ì™„ë£Œ: {experiment_dir}")
```

---

## ğŸ“ ì‹¤í—˜ëª… ëª…ëª… ê·œì¹™

ì‹¤í—˜ëª…(`experiment_name`)ì€ ì‘ì—… ë‚´ìš©ì„ ëª…í™•íˆ ë‚˜íƒ€ë‚´ì•¼ í•©ë‹ˆë‹¤:

### ê¸°ëŠ¥ ê°œë°œ
- í˜•ì‹: `feature_<ê¸°ëŠ¥ëª…>`
- ì˜ˆì‹œ:
  - `feature_web_search_tool`
  - `feature_file_save`
  - `feature_rag_retriever`

### RAG ê´€ë ¨ ì‘ì—…
- í˜•ì‹: `rag_<ì‘ì—…ë‚´ìš©>`
- ì˜ˆì‹œ:
  - `rag_vectordb_build`
  - `rag_document_loader_test`
  - `rag_retriever_evaluation`

### AI Agent ê´€ë ¨ ì‘ì—…
- í˜•ì‹: `agent_<ì‘ì—…ë‚´ìš©>`
- ì˜ˆì‹œ:
  - `agent_tool_calling_test`
  - `agent_routing_logic`
  - `agent_execution_demo`

### í‰ê°€ ì‘ì—…
- í˜•ì‹: `eval_<ëŒ€ìƒ>`
- ì˜ˆì‹œ:
  - `eval_chatbot_accuracy`
  - `eval_response_quality`
  - `eval_retrieval_performance`

### ë””ë²„ê¹…/í…ŒìŠ¤íŠ¸
- í˜•ì‹: `debug_<ë¬¸ì œ>` ë˜ëŠ” `test_<ëŒ€ìƒ>`
- ì˜ˆì‹œ:
  - `debug_memory_leak`
  - `debug_api_timeout`
  - `test_vectordb_connection`

---

## ğŸ“¦ ì‹¤í—˜ í´ë”ì— ì €ì¥í•´ì•¼ í•  íŒŒì¼ë“¤

### 1. í•„ìˆ˜ íŒŒì¼

#### ë¡œê·¸ íŒŒì¼ (í•„ìˆ˜)
```python
from src.utils.logger import Logger

# Logger ìƒì„± (ë°˜ë“œì‹œ ì‹¤í—˜ í´ë” ë‚´ë¶€ì—)
logger = Logger(f"{experiment_dir}/experiment.log")
```

#### Config ì„¤ì • íŒŒì¼ (í•„ìˆ˜)
```python
import yaml

# ì‹¤í–‰ ì‹œ ì‚¬ìš©í•œ ì„¤ì •ì„ ì €ì¥
config = {
    "model": "gpt-4",
    "temperature": 0.7,
    "max_tokens": 2000,
    "embedding_model": "text-embedding-3-small"
}

with open(f"{experiment_dir}/config.yaml", "w") as f:
    yaml.dump(config, f)
```

### 2. ê²°ê³¼ íŒŒì¼

#### ì‹¤í—˜ ê²°ê³¼ (JSON/CSV ë“±)
```python
import json

# ì‹¤í—˜ ê²°ê³¼ ì €ì¥
results = {
    "accuracy": 0.92,
    "f1_score": 0.89,
    "total_queries": 100,
    "successful": 92
}

with open(f"{experiment_dir}/results.json", "w") as f:
    json.dump(results, f, indent=2)
```

#### ì‚¬ìš©ì ì§ˆë¬¸ ë° ë‹µë³€
```python
import json

# ì±—ë´‡ ì‘ë‹µ ì €ì¥
responses = [
    {
        "question": "RAGë€ ë¬´ì—‡ì¸ê°€ìš”?",
        "answer": "RAGëŠ” Retrieval-Augmented Generationì˜ ì•½ìë¡œ...",
        "timestamp": "2025-10-28 14:30:52"
    },
    # ...
]

with open(f"{experiment_dir}/responses.json", "w", encoding="utf-8") as f:
    json.dump(responses, f, ensure_ascii=False, indent=2)
```

### 3. ë°ì´í„°ë² ì´ìŠ¤ ê²°ê³¼

#### VectorDB ì €ì¥
```python
from langchain_community.vectorstores import Chroma

# VectorDBë¥¼ ì‹¤í—˜ í´ë”ì— ì €ì¥
vectordb = Chroma.from_documents(
    documents=chunks,
    embedding=embeddings,
    persist_directory=f"{experiment_dir}/vectordb"
)
```

#### RDB ê²°ê³¼ (SQLite)
```python
import sqlite3

# SQLite DBë¥¼ ì‹¤í—˜ í´ë”ì— ì €ì¥
db_path = f"{experiment_dir}/results.db"
conn = sqlite3.connect(db_path)
# ... DB ì‘ì—… ...
conn.close()
```

### 4. ê¸°íƒ€ íŒŒì¼

#### ì²´í¬í¬ì¸íŠ¸/ëª¨ë¸ ê°€ì¤‘ì¹˜
```python
# ëª¨ë¸ ì²´í¬í¬ì¸íŠ¸ ì €ì¥
checkpoint_dir = f"{experiment_dir}/checkpoints"
os.makedirs(checkpoint_dir, exist_ok=True)

# ëª¨ë¸ ì €ì¥ (ì˜ˆì‹œ)
model.save(f"{checkpoint_dir}/model_epoch_10.pt")
```

#### ìŠ¤í¬ë¦°ìƒ·/ì‹œê°í™”
```python
import matplotlib.pyplot as plt

# ê·¸ë˜í”„ ì €ì¥
plt.figure()
plt.plot(losses)
plt.savefig(f"{experiment_dir}/loss_curve.png")
plt.close()
```

---

## ğŸ¯ ì‹¤ì „ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: RAG VectorDB êµ¬ì¶•

```python
import os
import yaml
from datetime import datetime
from src.utils.logger import Logger
from langchain_community.vectorstores import Chroma

def build_vectordb():
    # 1. ì‹¤í—˜ í´ë” ìƒì„±
    today = datetime.now().strftime("%Y%m%d")
    time_now = datetime.now().strftime("%H%M%S")
    experiment_name = "rag_vectordb_build"
    experiment_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"
    os.makedirs(experiment_dir, exist_ok=True)

    # 2. Logger ìƒì„±
    logger = Logger(f"{experiment_dir}/experiment.log")
    logger.write("VectorDB êµ¬ì¶• ì‹œì‘")

    # 3. Config ì €ì¥
    config = {
        "embedding_model": "text-embedding-3-small",
        "chunk_size": 500,
        "chunk_overlap": 50,
        "document_source": "data/raw/papers/"
    }
    with open(f"{experiment_dir}/config.yaml", "w") as f:
        yaml.dump(config, f)
    logger.write(f"Config ì €ì¥ ì™„ë£Œ: {experiment_dir}/config.yaml")

    # 4. ë¬¸ì„œ ë¡œë“œ ë° ì²˜ë¦¬
    documents = load_documents("data/raw/papers/")
    logger.write(f"ì´ {len(documents)}ê°œ ë¬¸ì„œ ë¡œë“œ ì™„ë£Œ")

    chunks = text_splitter.split_documents(documents)
    logger.write(f"{len(chunks)}ê°œ ì²­í¬ ìƒì„± ì™„ë£Œ")

    # 5. VectorDB ìƒì„± ë° ì €ì¥ (ì‹¤í—˜ í´ë” ë‚´ë¶€)
    vectordb = Chroma.from_documents(
        documents=chunks,
        embedding=embeddings,
        persist_directory=f"{experiment_dir}/vectordb"
    )
    logger.write(f"VectorDB ì €ì¥ ì™„ë£Œ: {experiment_dir}/vectordb")

    # 6. ê²°ê³¼ ìš”ì•½ ì €ì¥
    summary = {
        "total_documents": len(documents),
        "total_chunks": len(chunks),
        "vectordb_size": "100MB",  # ì˜ˆì‹œ
        "timestamp": datetime.now().isoformat()
    }
    with open(f"{experiment_dir}/summary.json", "w") as f:
        json.dump(summary, f, indent=2)

    logger.write("VectorDB êµ¬ì¶• ì™„ë£Œ")
    logger.close()

    return experiment_dir
```

### ì˜ˆì‹œ 2: ì±—ë´‡ í‰ê°€

```python
import os
import json
from datetime import datetime
from src.utils.logger import Logger

def evaluate_chatbot(test_questions):
    # 1. ì‹¤í—˜ í´ë” ìƒì„±
    today = datetime.now().strftime("%Y%m%d")
    time_now = datetime.now().strftime("%H%M%S")
    experiment_name = "eval_chatbot_accuracy"
    experiment_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"
    os.makedirs(experiment_dir, exist_ok=True)

    # 2. Logger ìƒì„±
    logger = Logger(f"{experiment_dir}/evaluation.log")
    logger.write(f"ì±—ë´‡ í‰ê°€ ì‹œì‘ - {len(test_questions)}ê°œ ì§ˆë¬¸")

    # 3. Config ì €ì¥
    config = {
        "model": "gpt-4",
        "temperature": 0.7,
        "max_tokens": 2000,
        "evaluation_criteria": ["accuracy", "relevance", "coherence"]
    }
    with open(f"{experiment_dir}/config.yaml", "w") as f:
        yaml.dump(config, f)

    # 4. í‰ê°€ ì‹¤í–‰ ë° ê²°ê³¼ ì €ì¥
    results = []
    for question in test_questions:
        answer = chatbot.generate(question)
        score = evaluator.score(question, answer)

        result = {
            "question": question,
            "answer": answer,
            "score": score
        }
        results.append(result)
        logger.write(f"ì§ˆë¬¸: {question} | ì ìˆ˜: {score}/5")

    # 5. ì „ì²´ ê²°ê³¼ ì €ì¥
    with open(f"{experiment_dir}/evaluation_results.json", "w", encoding="utf-8") as f:
        json.dump(results, f, ensure_ascii=False, indent=2)

    # 6. í†µê³„ ì €ì¥
    avg_score = sum(r["score"] for r in results) / len(results)
    stats = {
        "total_questions": len(test_questions),
        "average_score": avg_score,
        "passed": sum(1 for r in results if r["score"] >= 3),
        "failed": sum(1 for r in results if r["score"] < 3)
    }
    with open(f"{experiment_dir}/statistics.json", "w") as f:
        json.dump(stats, f, indent=2)

    logger.write(f"í‰ê°€ ì™„ë£Œ - í‰ê·  ì ìˆ˜: {avg_score:.2f}/5")
    logger.close()

    return experiment_dir
```

### ì˜ˆì‹œ 3: Agent ì‹¤í–‰ ë° ê¸°ë¡

```python
import os
import json
from datetime import datetime
from src.utils.logger import Logger

def run_agent_with_logging(user_query):
    # 1. ì‹¤í—˜ í´ë” ìƒì„±
    today = datetime.now().strftime("%Y%m%d")
    time_now = datetime.now().strftime("%H%M%S")
    experiment_name = "agent_execution"
    experiment_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"
    os.makedirs(experiment_dir, exist_ok=True)

    # 2. Logger ìƒì„±
    logger = Logger(f"{experiment_dir}/agent_execution.log")
    logger.write(f"ì‚¬ìš©ì ì§ˆë¬¸: {user_query}")

    # 3. ì§ˆë¬¸ ë¶„ë¥˜
    query_type = router.classify(user_query)
    logger.write(f"ì§ˆë¬¸ ìœ í˜•: {query_type}")

    # 4. ë„êµ¬ í˜¸ì¶œ ê¸°ë¡
    tool_logs = []
    if query_type == "web_search":
        logger.write("ì›¹ ê²€ìƒ‰ ë„êµ¬ í˜¸ì¶œ")
        result = web_search_tool.run(user_query)
        tool_logs.append({
            "tool": "web_search",
            "query": user_query,
            "result_length": len(result)
        })
    elif query_type == "rag":
        logger.write("RAG ê²€ìƒ‰ ë„êµ¬ í˜¸ì¶œ")
        result = rag_tool.run(user_query)
        tool_logs.append({
            "tool": "rag",
            "query": user_query,
            "result_length": len(result)
        })

    # 5. ë„êµ¬ í˜¸ì¶œ ë¡œê·¸ ì €ì¥
    with open(f"{experiment_dir}/tool_logs.json", "w", encoding="utf-8") as f:
        json.dump(tool_logs, f, ensure_ascii=False, indent=2)

    # 6. ìµœì¢… ì‘ë‹µ ì €ì¥
    response = {
        "question": user_query,
        "query_type": query_type,
        "answer": result,
        "timestamp": datetime.now().isoformat()
    }
    with open(f"{experiment_dir}/response.json", "w", encoding="utf-8") as f:
        json.dump(response, f, ensure_ascii=False, indent=2)

    logger.write("Agent ì‹¤í–‰ ì™„ë£Œ")
    logger.close()

    return result, experiment_dir
```

---

## âš ï¸ ì£¼ì˜ì‚¬í•­

### 1. ì ˆëŒ€ ê²½ë¡œ ì‚¬ìš© ê¸ˆì§€
âŒ ì˜ëª»ëœ ì˜ˆ:
```python
# í•˜ë“œì½”ë”©ëœ ê²½ë¡œ ì‚¬ìš© ê¸ˆì§€
experiment_dir = "C:/Users/myname/experiments/20251028/test/"
```

âœ… ì˜¬ë°”ë¥¸ ì˜ˆ:
```python
# ìƒëŒ€ ê²½ë¡œ + ë™ì  ìƒì„±
today = datetime.now().strftime("%Y%m%d")
time_now = datetime.now().strftime("%H%M%S")
experiment_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"
```

### 2. í´ë” ìƒì„± í™•ì¸
ë°˜ë“œì‹œ `os.makedirs()`ë¡œ í´ë”ë¥¼ ìƒì„±í•˜ì„¸ìš”:
```python
os.makedirs(experiment_dir, exist_ok=True)  # exist_ok=True í•„ìˆ˜
```

### 3. í•œê¸€ íŒŒì¼ëª… ì‚¬ìš© ì‹œ ì¸ì½”ë”©
í•œê¸€ì´ í¬í•¨ëœ íŒŒì¼ ì €ì¥ ì‹œ UTF-8 ì¸ì½”ë”©ì„ ëª…ì‹œ:
```python
with open(f"{experiment_dir}/ê²°ê³¼.json", "w", encoding="utf-8") as f:
    json.dump(data, f, ensure_ascii=False, indent=2)
```

### 4. ë¡œê·¸ íŒŒì¼ì€ í•­ìƒ ì‹¤í—˜ í´ë” ë‚´ë¶€ì—
âŒ ì˜ëª»ëœ ì˜ˆ:
```python
logger = Logger("logs/experiment.log")  # ë³„ë„ í´ë”ì— ë¡œê·¸ ì €ì¥
```

âœ… ì˜¬ë°”ë¥¸ ì˜ˆ:
```python
logger = Logger(f"{experiment_dir}/experiment.log")  # ì‹¤í—˜ í´ë”ì— ë¡œê·¸ ì €ì¥
```

---

## ğŸ“‹ ì²´í¬ë¦¬ìŠ¤íŠ¸

ì½”ë“œ ì‹¤í–‰ ì „ ë‹¤ìŒì„ í™•ì¸í•˜ì„¸ìš”:

- [ ] `experiments/{ë‚ ì§œ}/{ë‚ ì§œ}_{ì‹œê°„}_{ì‹¤í—˜ëª…}` í˜•ì‹ìœ¼ë¡œ í´ë” ìƒì„±
- [ ] ì‹¤í—˜ëª…ì´ ì‘ì—… ë‚´ìš©ì„ ëª…í™•íˆ ë‚˜íƒ€ëƒ„
- [ ] Loggerë¥¼ ì‹¤í—˜ í´ë” ë‚´ë¶€ì— ìƒì„±
- [ ] Config ì„¤ì •ì„ YAML/JSONìœ¼ë¡œ ì €ì¥
- [ ] ëª¨ë“  ê²°ê³¼ë¬¼(ë‹µë³€, DB, ëª¨ë¸ ë“±)ì„ ë™ì¼í•œ ì‹¤í—˜ í´ë”ì— ì €ì¥
- [ ] ì‹¤í—˜ ì™„ë£Œ í›„ Logger ì¢…ë£Œ (`logger.close()`)

---

## ğŸ” ì‹¤í—˜ í´ë” ì°¾ê¸°

ë‚ ì§œë³„ë¡œ ì‹¤í—˜ì„ ì°¾ìœ¼ë ¤ë©´:
```bash
# íŠ¹ì • ë‚ ì§œì˜ ëª¨ë“  ì‹¤í—˜ ë³´ê¸°
ls experiments/20251028/

# íŠ¹ì • ì‹¤í—˜ëª… ê²€ìƒ‰
ls experiments/20251028/ | grep "rag_vectordb"

# ìµœì‹  ì‹¤í—˜ ì°¾ê¸°
ls -lt experiments/20251028/ | head -5
```

---

## ğŸ“š ì°¸ê³ 

- Logger ì‚¬ìš©ë²•: `docs/rules/logger_ì‚¬ìš©ë²•.md`
- ë””ë ‰í† ë¦¬ êµ¬ì¡°: `docs/PRD/ë””ë ‰í† ë¦¬_êµ¬ì¡°.md`
- Commit ê·œì¹™: `docs/rules/commit_style.md`

---

## ğŸ’¡ í•µì‹¬ ì •ë¦¬

1. **ëª¨ë“  ì‹¤í—˜ ê²°ê³¼ë¬¼**ì€ `experiments/{ë‚ ì§œ}/{ë‚ ì§œ}_{ì‹œê°„}_{ì‹¤í—˜ëª…}/` í´ë”ì— ì €ì¥
2. **ë¡œê·¸, config, ê²°ê³¼ë¬¼, DB, ëª¨ë¸** ë“± ëª¨ë‘ ë™ì¼í•œ ì‹¤í—˜ í´ë”ì— í•¨ê»˜ ì €ì¥
3. **ì‹¤í—˜ëª…ì€ ì‘ì—… ë‚´ìš©**ì„ ëª…í™•íˆ ë‚˜íƒ€ë‚´ì•¼ í•¨
4. **ë‚ ì§œì™€ ì‹œê°„**ì„ ìë™ìœ¼ë¡œ ìƒì„±í•˜ì—¬ í´ë”ëª… ì¤‘ë³µ ë°©ì§€
5. íŒ€ì›ë“¤ì€ ì´ ê·œì¹™ì„ **ë°˜ë“œì‹œ ë”°ë¼ì•¼** í•¨
