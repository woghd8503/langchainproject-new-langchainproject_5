# ë‹´ë‹¹ì—­í• _01-1: ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-31
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±
- **ë‹´ë‹¹ ê¸°ëŠ¥**: ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ, ExperimentManager í´ë˜ìŠ¤, Session ìë™ ê´€ë¦¬

---

## ë‹´ë‹¹ì ì •ë³´

**ë‹´ë‹¹ì**: ìµœí˜„í™”[íŒ€ì¥]

**ì—­í• **: ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶• ë° ExperimentManager í´ë˜ìŠ¤ êµ¬í˜„

---

## ë‹´ë‹¹ ì—…ë¬´ ê°œìš”

ì´ ì—­í• ì€ í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ëŠ” **ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ** êµ¬ì¶•ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì±—ë´‡ ì‹¤í–‰ ì‹œë§ˆë‹¤ ìë™ìœ¼ë¡œ í´ë” êµ¬ì¡°ë¥¼ ìƒì„±í•˜ê³ , ëª¨ë“  ì‹¤í–‰ ì •ë³´(ë¡œê·¸, DB ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI ì¸í„°ë™ì…˜, í‰ê°€ ì§€í‘œ)ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê¸°ë¡í•©ë‹ˆë‹¤.

### ì£¼ìš” ì±…ì„

1. **ExperimentManager í´ë˜ìŠ¤ êµ¬í˜„** (`src/utils/experiment_manager.py`)
   - Session ID ìë™ ë¶€ì—¬ ì‹œìŠ¤í…œ
   - 7ê°œ ì„œë¸Œ í´ë” ìë™ ìƒì„± ë° ê´€ë¦¬
   - metadata.json ì¤‘ì•™ ê´€ë¦¬
   - ë„êµ¬ë³„ Logger ì œê³µ

2. **ë°ì´í„° ì €ì¥ ë©”ì„œë“œ êµ¬í˜„**
   - DB ì¿¼ë¦¬ ë° ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
   - í”„ë¡¬í”„íŠ¸ ê¸°ë¡ (system/user/final)
   - UI ì¸í„°ë™ì…˜ ë¡œê·¸
   - í‰ê°€ ì§€í‘œ ì €ì¥ (RAG, Agent, ë¹„ìš©, ì‘ë‹µì‹œê°„)
   - ìµœì¢… ê²°ê³¼ë¬¼ ì €ì¥

3. **ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„ ë„êµ¬**
   - metadata.json ê¸°ë°˜ ì‹¤í—˜ ê²€ìƒ‰
   - í‰ê°€ ì§€í‘œ ì§‘ê³„ ê¸°ëŠ¥

---

## ì°¸ì—¬ ê¸°ê°„ ë° ìš°ì„ ìˆœìœ„

### ì°¸ì—¬ ê¸°ê°„
- **ì „ì²´ ê¸°ê°„ ì°¸ì—¬** (2025-10-28 ~ 2025-11-06, 10ì¼)
- **ìš°ì„  ì‘ì—… ê¸°ê°„**: í”„ë¡œì íŠ¸ ì´ˆê¸° (10/28-10/30, 3ì¼)
  - ExperimentManager í´ë˜ìŠ¤ë¥¼ ë¨¼ì € êµ¬í˜„í•´ì•¼ ë‹¤ë¥¸ íŒ€ì›ë“¤ì´ ì‚¬ìš© ê°€ëŠ¥

### ìš°ì„ ìˆœìœ„
1. **ìµœìš°ì„  (Day 1-3)**: ExperimentManager ê¸°ë³¸ ê¸°ëŠ¥ êµ¬í˜„
   - í´ë” êµ¬ì¡° ìë™ ìƒì„±
   - Session ID ìë™ ë¶€ì—¬
   - metadata.json ê´€ë¦¬
   - ë„êµ¬ë³„ Logger ì œê³µ

2. **ìš°ì„  (Day 4-6)**: ë°ì´í„° ì €ì¥ ë©”ì„œë“œ êµ¬í˜„
   - DB ì¿¼ë¦¬ ê¸°ë¡
   - í”„ë¡¬í”„íŠ¸ ì €ì¥
   - UI ì¸í„°ë™ì…˜ ë¡œê·¸
   - í‰ê°€ ì§€í‘œ ì €ì¥

3. **ì„ íƒ (Day 7+)**: ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„ ë„êµ¬
   - find_experiments ìŠ¤í¬ë¦½íŠ¸
   - í‰ê°€ ì§€í‘œ ì§‘ê³„ ê¸°ëŠ¥

---

## ì„¸ë¶€ ì—…ë¬´ ë° êµ¬í˜„ ë‚´ìš©

### 1. ExperimentManager í´ë˜ìŠ¤ ê¸°ë³¸ êµ¬ì¡°

**íŒŒì¼ ê²½ë¡œ**: `src/utils/experiment_manager.py`

#### 1.1 í´ë˜ìŠ¤ ì „ì²´ ì½”ë“œ

```python
import json
import yaml
from pathlib import Path
from datetime import datetime
from typing import Dict, List, Optional
from src.utils.logger import Logger


class ExperimentManager:
    """
    ì‹¤í—˜ í´ë” ìƒì„± ë° ê´€ë¦¬ í´ë˜ìŠ¤

    DB, UI, í”„ë¡¬í”„íŠ¸ ë“± ëª¨ë“  ì •ë³´ë¥¼ ì²´ê³„ì ìœ¼ë¡œ ê¸°ë¡
    """

    def __init__(self):
        """ì‹¤í—˜ ë§¤ë‹ˆì € ì´ˆê¸°í™”"""
        today = datetime.now().strftime("%Y%m%d")
        time_now = datetime.now().strftime("%H%M%S")

        # ë‹¹ì¼ session ID ìƒì„±
        session_id = self._get_next_session_id(today)

        # ë©”ì¸ í´ë”
        self.experiment_dir = Path(
            f"experiments/{today}/{today}_{time_now}_session_{session_id:03d}"
        )
        self.experiment_dir.mkdir(parents=True, exist_ok=True)

        # ì„œë¸Œ í´ë” ìƒì„±
        self.tools_dir = self.experiment_dir / "tools"
        self.database_dir = self.experiment_dir / "database"
        self.prompts_dir = self.experiment_dir / "prompts"
        self.ui_dir = self.experiment_dir / "ui"
        self.outputs_dir = self.experiment_dir / "outputs"
        self.evaluation_dir = self.experiment_dir / "evaluation"
        self.debug_dir = self.experiment_dir / "debug"

        # í•„ìˆ˜ í´ë” ìƒì„±
        for folder in [self.tools_dir, self.database_dir, self.prompts_dir,
                       self.ui_dir, self.outputs_dir, self.evaluation_dir]:
            folder.mkdir(exist_ok=True)

        # ë©”íƒ€ë°ì´í„° ì´ˆê¸°í™”
        self.metadata = {
            'session_id': f"{session_id:03d}",
            'start_time': datetime.now().isoformat(),
            'difficulty': None,
            'tool_used': None,
            'user_query': None,
            'success': None,
            'response_time_ms': None,
            'end_time': None
        }

        self.metadata_file = self.experiment_dir / "metadata.json"

        # Logger ì´ˆê¸°í™”
        self.logger = Logger(str(self.experiment_dir / "chatbot.log"))
        self.logger.write(f"ì„¸ì…˜ ì‹œì‘: session_{session_id:03d}")
        self.logger.write(f"í´ë” ê²½ë¡œ: {self.experiment_dir}")

        # DB ê´€ë ¨ ì´ˆê¸°í™”
        self.db_queries = []
        self.pgvector_searches = []
        self.search_results = {}
        self.db_performance = {
            'summary': {},
            'queries': []
        }

    def _get_next_session_id(self, date: str) -> int:
        """ë‹¹ì¼ ë‹¤ìŒ session ID ë°˜í™˜"""
        date_dir = Path(f"experiments/{date}")
        if not date_dir.exists():
            return 1

        existing_sessions = list(date_dir.glob(f"{date}_*_session_*"))
        if not existing_sessions:
            return 1

        max_id = 0
        for session_dir in existing_sessions:
            try:
                session_id_str = session_dir.name.split('_')[-1]
                session_id = int(session_id_str)
                max_id = max(max_id, session_id)
            except (IndexError, ValueError):
                continue

        return max_id + 1

    # ===== ë„êµ¬ ë¡œê·¸ =====

    def get_tool_logger(self, tool_name: str) -> Logger:
        """
        ë„êµ¬ë³„ Logger ìƒì„±

        Args:
            tool_name: ë„êµ¬ëª… (rag_paper, rag_glossary, web_search ë“±)

        Returns:
            Logger ì¸ìŠ¤í„´ìŠ¤
        """
        log_path = self.tools_dir / f"{tool_name}.log"
        return Logger(str(log_path))

    # ===== DB ê´€ë ¨ =====

    def log_sql_query(
        self,
        query: str,
        description: str = "",
        tool: str = "",
        execution_time_ms: Optional[int] = None
    ):
        """
        SQL ì¿¼ë¦¬ ê¸°ë¡

        Args:
            query: SQL ì¿¼ë¦¬ë¬¸
            description: ì¿¼ë¦¬ ì„¤ëª…
            tool: ì‚¬ìš©í•œ ë„êµ¬ëª…
            execution_time_ms: ì‹¤í–‰ ì‹œê°„ (ë°€ë¦¬ì´ˆ)
        """
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")

        query_record = f"""-- ì‹¤í–‰ ì‹œê°„: {timestamp}
-- ë„êµ¬: {tool}
-- ì„¤ëª…: {description}
"""
        if execution_time_ms:
            query_record += f"-- ì‹¤í–‰ ì†Œìš”: {execution_time_ms}ms\n"

        query_record += f"\n{query};\n\n"

        self.db_queries.append(query_record)

        # queries.sql íŒŒì¼ì— ì¦‰ì‹œ ì¶”ê°€
        with open(self.database_dir / "queries.sql", 'a', encoding='utf-8') as f:
            f.write(query_record)

        self.logger.write(f"SQL ì¿¼ë¦¬ ê¸°ë¡: {description}")

    def log_pgvector_search(self, search_info: Dict):
        """
        pgvector ê²€ìƒ‰ ê¸°ë¡

        Args:
            search_info: ê²€ìƒ‰ ì •ë³´ ë”•ì…”ë„ˆë¦¬
                - tool: ë„êµ¬ëª…
                - collection: ì»¬ë ‰ì…˜ëª…
                - query_text: ê²€ìƒ‰ ì¿¼ë¦¬
                - top_k: ê²€ìƒ‰ ê²°ê³¼ ìˆ˜
                - execution_time_ms: ì‹¤í–‰ ì‹œê°„
                ë“±
        """
        search_info['timestamp'] = datetime.now().isoformat()
        self.pgvector_searches.append(search_info)

        # pgvector_searches.json ì—…ë°ì´íŠ¸
        with open(self.database_dir / "pgvector_searches.json", 'w', encoding='utf-8') as f:
            json.dump(self.pgvector_searches, f, ensure_ascii=False, indent=2)

        self.logger.write(f"pgvector ê²€ìƒ‰ ê¸°ë¡: {search_info.get('tool', 'unknown')}")

    def save_search_results(self, tool_name: str, results: Dict):
        """
        DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥

        Args:
            tool_name: ë„êµ¬ëª…
            results: ê²€ìƒ‰ ê²°ê³¼ ë”•ì…”ë„ˆë¦¬
        """
        results['timestamp'] = datetime.now().isoformat()
        self.search_results[tool_name] = results

        # search_results.json ì—…ë°ì´íŠ¸
        with open(self.database_dir / "search_results.json", 'w', encoding='utf-8') as f:
            json.dump(self.search_results, f, ensure_ascii=False, indent=2)

        self.logger.write(f"ê²€ìƒ‰ ê²°ê³¼ ì €ì¥: {tool_name}")

    def save_db_performance(self, performance_data: Dict):
        """
        DB ì„±ëŠ¥ ì •ë³´ ì €ì¥

        Args:
            performance_data: ì„±ëŠ¥ ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        with open(self.database_dir / "db_performance.json", 'w', encoding='utf-8') as f:
            json.dump(performance_data, f, ensure_ascii=False, indent=2)

        self.logger.write("DB ì„±ëŠ¥ ì •ë³´ ì €ì¥ ì™„ë£Œ")

    # ===== í”„ë¡¬í”„íŠ¸ ê´€ë ¨ =====

    def save_system_prompt(self, system_prompt: str, metadata: Optional[Dict] = None):
        """
        ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥

        Args:
            system_prompt: ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸
            metadata: ë©”íƒ€ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        content = system_prompt

        if metadata:
            content += "\n\n===== ë©”íƒ€ë°ì´í„° =====\n"
            for key, value in metadata.items():
                content += f"{key}: {value}\n"

        with open(self.prompts_dir / "system_prompt.txt", 'w', encoding='utf-8') as f:
            f.write(content)

        self.logger.write("ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥ ì™„ë£Œ")

    def save_user_prompt(self, user_prompt: str, metadata: Optional[Dict] = None):
        """
        ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥

        Args:
            user_prompt: ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸
            metadata: ë©”íƒ€ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        content = user_prompt

        if metadata:
            content += "\n\n===== ë©”íƒ€ë°ì´í„° =====\n"
            for key, value in metadata.items():
                content += f"{key}: {value}\n"

        with open(self.prompts_dir / "user_prompt.txt", 'w', encoding='utf-8') as f:
            f.write(content)

        self.logger.write("ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥ ì™„ë£Œ")

    def save_final_prompt(self, final_prompt: str, metadata: Optional[Dict] = None):
        """
        ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥

        Args:
            final_prompt: ìµœì¢… í”„ë¡¬í”„íŠ¸ í…ìŠ¤íŠ¸
            metadata: ë©”íƒ€ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        content = final_prompt

        if metadata:
            content += "\n\n===== ë©”íƒ€ë°ì´í„° =====\n"
            for key, value in metadata.items():
                content += f"{key}: {value}\n"

        with open(self.prompts_dir / "final_prompt.txt", 'w', encoding='utf-8') as f:
            f.write(content)

        self.logger.write("ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥ ì™„ë£Œ")

    def save_prompt_template(self, template_info: Dict):
        """
        í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´ ì €ì¥

        Args:
            template_info: í…œí”Œë¦¿ ì •ë³´ ë”•ì…”ë„ˆë¦¬
        """
        with open(self.prompts_dir / "prompt_template.yaml", 'w', encoding='utf-8') as f:
            yaml.dump(template_info, f, allow_unicode=True, sort_keys=False)

        self.logger.write("í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì €ì¥ ì™„ë£Œ")

    # ===== UI ê´€ë ¨ =====

    def save_streamlit_session(self, session_data: Dict):
        """
        Streamlit ì„¸ì…˜ ìƒíƒœ ì €ì¥

        Args:
            session_data: ì„¸ì…˜ ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        with open(self.ui_dir / "streamlit_session.json", 'w', encoding='utf-8') as f:
            json.dump(session_data, f, ensure_ascii=False, indent=2)

        self.logger.write("Streamlit ì„¸ì…˜ ì €ì¥ ì™„ë£Œ")

    def log_ui_interaction(self, interaction: str):
        """
        UI ì¸í„°ë™ì…˜ ë¡œê·¸

        Args:
            interaction: ì¸í„°ë™ì…˜ ì„¤ëª…
        """
        timestamp = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
        log_line = f"{timestamp} | {interaction}\n"

        with open(self.ui_dir / "user_interactions.log", 'a', encoding='utf-8') as f:
            f.write(log_line)

    def log_ui_event(self, event: Dict):
        """
        UI ì´ë²¤íŠ¸ ê¸°ë¡

        Args:
            event: ì´ë²¤íŠ¸ ë”•ì…”ë„ˆë¦¬
        """
        event['timestamp'] = datetime.now().isoformat()

        # ê¸°ì¡´ ì´ë²¤íŠ¸ ì½ê¸°
        events_file = self.ui_dir / "ui_events.json"
        if events_file.exists():
            with open(events_file, 'r', encoding='utf-8') as f:
                events = json.load(f)
        else:
            events = []

        events.append(event)

        # ì—…ë°ì´íŠ¸
        with open(events_file, 'w', encoding='utf-8') as f:
            json.dump(events, f, ensure_ascii=False, indent=2)

    # ===== ì¶œë ¥ ê´€ë ¨ =====

    def save_output(self, filename: str, content: str):
        """
        ê²°ê³¼ë¬¼ ì €ì¥

        Args:
            filename: íŒŒì¼ëª…
            content: ë‚´ìš©
        """
        output_path = self.outputs_dir / filename
        with open(output_path, 'w', encoding='utf-8') as f:
            f.write(content)

        self.logger.write(f"ê²°ê³¼ë¬¼ ì €ì¥: {filename}")

    # ===== í‰ê°€ ì§€í‘œ ê´€ë ¨ =====

    def save_rag_metrics(self, metrics: Dict):
        """
        RAG í‰ê°€ ì§€í‘œ ì €ì¥

        Args:
            metrics: RAG í‰ê°€ ì§€í‘œ ë”•ì…”ë„ˆë¦¬
        """
        metrics['timestamp'] = datetime.now().isoformat()

        with open(self.evaluation_dir / "rag_metrics.json", 'w', encoding='utf-8') as f:
            json.dump(metrics, f, ensure_ascii=False, indent=2)

        self.logger.write("RAG í‰ê°€ ì§€í‘œ ì €ì¥ ì™„ë£Œ")

    def save_agent_accuracy(self, accuracy_data: Dict):
        """
        Agent ì •í™•ë„ ì €ì¥

        Args:
            accuracy_data: Agent ì •í™•ë„ ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        accuracy_data['timestamp'] = datetime.now().isoformat()

        with open(self.evaluation_dir / "agent_accuracy.json", 'w', encoding='utf-8') as f:
            json.dump(accuracy_data, f, ensure_ascii=False, indent=2)

        self.logger.write("Agent ì •í™•ë„ ì €ì¥ ì™„ë£Œ")

    def save_latency_report(self, latency_data: Dict):
        """
        ì‘ë‹µ ì‹œê°„ ë¶„ì„ ì €ì¥

        Args:
            latency_data: ì‘ë‹µ ì‹œê°„ ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        latency_data['timestamp'] = datetime.now().isoformat()

        with open(self.evaluation_dir / "latency_report.json", 'w', encoding='utf-8') as f:
            json.dump(latency_data, f, ensure_ascii=False, indent=2)

        self.logger.write("ì‘ë‹µ ì‹œê°„ ë¶„ì„ ì €ì¥ ì™„ë£Œ")

    def save_cost_analysis(self, cost_data: Dict):
        """
        ë¹„ìš© ë¶„ì„ ì €ì¥

        Args:
            cost_data: ë¹„ìš© ë¶„ì„ ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        cost_data['timestamp'] = datetime.now().isoformat()

        with open(self.evaluation_dir / "cost_analysis.json", 'w', encoding='utf-8') as f:
            json.dump(cost_data, f, ensure_ascii=False, indent=2)

        self.logger.write("ë¹„ìš© ë¶„ì„ ì €ì¥ ì™„ë£Œ")

    def save_test_results(self, test_data: Dict):
        """
        í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥

        Args:
            test_data: í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë°ì´í„° ë”•ì…”ë„ˆë¦¬
        """
        test_data['timestamp'] = datetime.now().isoformat()

        with open(self.evaluation_dir / "test_results.json", 'w', encoding='utf-8') as f:
            json.dump(test_data, f, ensure_ascii=False, indent=2)

        self.logger.write("í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥ ì™„ë£Œ")

    # ===== ë””ë²„ê·¸ ê´€ë ¨ =====

    def save_debug_info(self, filename: str, data: Dict):
        """
        ë””ë²„ê·¸ ì •ë³´ ì €ì¥

        Args:
            filename: íŒŒì¼ëª…
            data: ë””ë²„ê·¸ ë°ì´í„°
        """
        # debug í´ë”ê°€ ì—†ìœ¼ë©´ ìƒì„±
        self.debug_dir.mkdir(exist_ok=True)

        debug_path = self.debug_dir / filename
        with open(debug_path, 'w', encoding='utf-8') as f:
            json.dump(data, f, ensure_ascii=False, indent=2)

    # ===== ë©”íƒ€ë°ì´í„° ê´€ë ¨ =====

    def update_metadata(self, **kwargs):
        """
        ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸

        Args:
            **kwargs: ì—…ë°ì´íŠ¸í•  í‚¤-ê°’ ìŒ
        """
        self.metadata.update(kwargs)

        with open(self.metadata_file, 'w', encoding='utf-8') as f:
            json.dump(self.metadata, f, ensure_ascii=False, indent=2)

        self.logger.write(f"ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸: {list(kwargs.keys())}")

    def save_config(self, config: Dict):
        """
        ì „ì²´ ì„¤ì • ì €ì¥

        Args:
            config: ì„¤ì • ë”•ì…”ë„ˆë¦¬
        """
        config_path = self.experiment_dir / "config.yaml"
        with open(config_path, 'w', encoding='utf-8') as f:
            yaml.dump(config, f, allow_unicode=True, sort_keys=False)

        self.logger.write("ì„¤ì • íŒŒì¼ ì €ì¥ ì™„ë£Œ")

    def close(self):
        """ì‹¤í—˜ ì¢…ë£Œ"""
        # ì¢…ë£Œ ì‹œê°„ ê¸°ë¡
        self.metadata['end_time'] = datetime.now().isoformat()

        # ìµœì¢… ë©”íƒ€ë°ì´í„° ì €ì¥
        with open(self.metadata_file, 'w', encoding='utf-8') as f:
            json.dump(self.metadata, f, ensure_ascii=False, indent=2)

        self.logger.write("=" * 50)
        self.logger.write("ì‹¤í—˜ ì¢…ë£Œ")
        self.logger.write("=" * 50)
        self.logger.close()

    def __enter__(self):
        """with ë¬¸ ì§€ì›"""
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """with ë¬¸ ì¢…ë£Œ ì‹œ ìë™ close"""
        self.close()
```

---

### 2. í´ë” êµ¬ì¡° ìë™ ìƒì„±

#### 2.1 ìƒì„±ë˜ëŠ” í´ë” êµ¬ì¡°

```
experiments/20251031/20251031_103015_session_001/
â”œâ”€â”€ metadata.json                    # â­ ì „ì²´ ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
â”œâ”€â”€ chatbot.log                      # ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
â”œâ”€â”€ config.yaml                      # ì „ì²´ ì„¤ì •
â”‚
â”œâ”€â”€ tools/                           # ğŸ”§ ë„êµ¬ ì‹¤í–‰ ë¡œê·¸
â”‚   â”œâ”€â”€ rag_paper.log
â”‚   â”œâ”€â”€ rag_glossary.log
â”‚   â”œâ”€â”€ web_search.log
â”‚   â”œâ”€â”€ summary_paper.log
â”‚   â”œâ”€â”€ file_save.log
â”‚   â””â”€â”€ general.log
â”‚
â”œâ”€â”€ database/                        # ğŸ—„ï¸ DB ê´€ë ¨ ê¸°ë¡
â”‚   â”œâ”€â”€ queries.sql
â”‚   â”œâ”€â”€ pgvector_searches.json
â”‚   â”œâ”€â”€ search_results.json
â”‚   â””â”€â”€ db_performance.json
â”‚
â”œâ”€â”€ prompts/                         # ğŸ’¬ í”„ë¡¬í”„íŠ¸ ê¸°ë¡
â”‚   â”œâ”€â”€ system_prompt.txt
â”‚   â”œâ”€â”€ user_prompt.txt
â”‚   â”œâ”€â”€ final_prompt.txt
â”‚   â””â”€â”€ prompt_template.yaml
â”‚
â”œâ”€â”€ ui/                              # ğŸ–¥ï¸ UI ê´€ë ¨ ê¸°ë¡
â”‚   â”œâ”€â”€ streamlit_session.json
â”‚   â”œâ”€â”€ user_interactions.log
â”‚   â””â”€â”€ ui_events.json
â”‚
â”œâ”€â”€ outputs/                         # ğŸ“„ ìƒì„±ëœ ê²°ê³¼ë¬¼
â”‚   â”œâ”€â”€ response.txt
â”‚   â”œâ”€â”€ summary.md
â”‚   â””â”€â”€ saved_file.txt
â”‚
â”œâ”€â”€ evaluation/                      # ğŸ“Š í‰ê°€ ì§€í‘œ
â”‚   â”œâ”€â”€ rag_metrics.json
â”‚   â”œâ”€â”€ agent_accuracy.json
â”‚   â”œâ”€â”€ latency_report.json
â”‚   â”œâ”€â”€ cost_analysis.json
â”‚   â””â”€â”€ test_results.json
â”‚
â””â”€â”€ debug/                           # ğŸ› ë””ë²„ê·¸ ì •ë³´ (ì„ íƒ)
    â”œâ”€â”€ agent_trace.json
    â”œâ”€â”€ llm_tokens.json
    â””â”€â”€ error_trace.log
```

#### 2.2 Session ID ìë™ ë¶€ì—¬ ë¡œì§

```python
def _get_next_session_id(self, date: str) -> int:
    """
    ë‹¹ì¼ ë‹¤ìŒ session ID ë°˜í™˜

    ì˜ˆì‹œ:
    - ì²« ì‹¤í–‰: session_001
    - ë‘ ë²ˆì§¸ ì‹¤í–‰: session_002
    - ë‹¤ìŒ ë‚ : ë‹¤ì‹œ session_001ë¶€í„° ì‹œì‘
    """
    date_dir = Path(f"experiments/{date}")

    # ë‚ ì§œ í´ë”ê°€ ì—†ìœ¼ë©´ ì²« ì‹¤í–‰
    if not date_dir.exists():
        return 1

    # ê¸°ì¡´ session í´ë” ì°¾ê¸°
    existing_sessions = list(date_dir.glob(f"{date}_*_session_*"))
    if not existing_sessions:
        return 1

    # ê°€ì¥ í° session ID ì°¾ê¸°
    max_id = 0
    for session_dir in existing_sessions:
        try:
            session_id_str = session_dir.name.split('_')[-1]
            session_id = int(session_id_str)
            max_id = max(max_id, session_id)
        except (IndexError, ValueError):
            continue

    return max_id + 1
```

---

### 3. ì‚¬ìš© ì˜ˆì‹œ

#### 3.1 ê¸°ë³¸ ì‚¬ìš©

```python
from src.utils.experiment_manager import ExperimentManager

# with ë¬¸ìœ¼ë¡œ ìë™ ì´ˆê¸°í™” ë° ì¢…ë£Œ
with ExperimentManager() as exp:
    # ìë™ìœ¼ë¡œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰:
    # 1. experiments/20251031/20251031_103015_session_001/ ìƒì„±
    # 2. ì„œë¸Œ í´ë” 6ê°œ ìƒì„±
    # 3. metadata.json ì´ˆê¸°í™”
    # 4. chatbot.log ìƒì„±

    # ë©”ì¸ ë¡œê·¸ ê¸°ë¡
    exp.logger.write("ì±—ë´‡ ì‹¤í–‰ ì‹œì‘")

    # ì‚¬ìš©ì ì§ˆë¬¸
    question = "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜"

    # ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
    exp.update_metadata(
        user_query=question,
        difficulty="easy"
    )

    # ... ì±—ë´‡ ì‹¤í–‰ ...

    # with ë¸”ë¡ì´ ëë‚˜ë©´ ìë™ìœ¼ë¡œ close() í˜¸ì¶œ
```

#### 3.2 ë„êµ¬ë³„ Logger ì‚¬ìš©

```python
with ExperimentManager() as exp:
    # ë„êµ¬ë³„ ë…ë¦½ Logger ìƒì„±
    rag_logger = exp.get_tool_logger('rag_paper')
    rag_logger.write("ë…¼ë¬¸ ê²€ìƒ‰ ì‹œì‘")
    rag_logger.write("ê²€ìƒ‰ ì™„ë£Œ: 5ê°œ ë…¼ë¬¸ ë°œê²¬")
    rag_logger.close()

    # ë‹¤ë¥¸ ë„êµ¬
    web_logger = exp.get_tool_logger('web_search')
    web_logger.write("ì›¹ ê²€ìƒ‰ ì‹œì‘")
    web_logger.close()
```

#### 3.3 DB ì¿¼ë¦¬ ê¸°ë¡

```python
with ExperimentManager() as exp:
    # SQL ì¿¼ë¦¬ ê¸°ë¡
    exp.log_sql_query(
        query="SELECT * FROM papers WHERE paper_id = 123",
        description="ë…¼ë¬¸ ë©”íƒ€ë°ì´í„° ì¡°íšŒ",
        tool="rag_paper",
        execution_time_ms=12
    )

    # pgvector ê²€ìƒ‰ ê¸°ë¡
    exp.log_pgvector_search({
        "tool": "rag_paper",
        "collection": "paper_chunks",
        "query_text": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
        "top_k": 5,
        "execution_time_ms": 45
    })

    # ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
    exp.save_search_results("rag_paper", {
        "query": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
        "results_count": 5,
        "papers": [...]
    })
```

#### 3.4 í”„ë¡¬í”„íŠ¸ ì €ì¥

```python
with ExperimentManager() as exp:
    # ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥
    exp.save_system_prompt(
        system_prompt="ë‹¹ì‹ ì€ ë…¼ë¬¸ì„ ì‰½ê²Œ ì„¤ëª…í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.",
        metadata={"ë‚œì´ë„": "easy", "í…œí”Œë¦¿": "EASY_SYSTEM_PROMPT"}
    )

    # ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥
    exp.save_user_prompt(
        user_prompt="[ì°¸ê³  ë…¼ë¬¸]\n...\n\n[ì§ˆë¬¸]\nRAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
        metadata={"ê²€ìƒ‰ ê²°ê³¼ ìˆ˜": 5}
    )

    # ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥
    exp.save_final_prompt(final_prompt)

    # í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´ ì €ì¥
    exp.save_prompt_template({
        "difficulty": "easy",
        "llm_config": {"model": "gpt-4", "temperature": 0.7}
    })
```

#### 3.5 UI ì¸í„°ë™ì…˜ ê¸°ë¡

```python
with ExperimentManager() as exp:
    # ì¸í„°ë™ì…˜ ë¡œê·¸
    exp.log_ui_interaction("í˜ì´ì§€ ì ‘ì†")
    exp.log_ui_interaction("ë‚œì´ë„ ì„ íƒ: easy")
    exp.log_ui_interaction("ì§ˆë¬¸ ì…ë ¥: RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜")

    # UI ì´ë²¤íŠ¸ ê¸°ë¡
    exp.log_ui_event({
        "event_type": "difficulty_changed",
        "old_value": None,
        "new_value": "easy"
    })

    # Streamlit ì„¸ì…˜ ì €ì¥
    exp.save_streamlit_session({
        "session_id": "abc123",
        "messages": [...]
    })
```

#### 3.6 í‰ê°€ ì§€í‘œ ì €ì¥

```python
with ExperimentManager() as exp:
    # RAG í‰ê°€ ì§€í‘œ
    exp.save_rag_metrics({
        "retrieval_metrics": {"recall_at_5": 0.8},
        "generation_metrics": {"faithfulness": 0.95}
    })

    # Agent ì •í™•ë„
    exp.save_agent_accuracy({
        "routing_decision": {"predicted_tool": "rag_paper", "correct": True}
    })

    # ì‘ë‹µ ì‹œê°„ ë¶„ì„
    exp.save_latency_report({
        "total_latency": {"total_time_ms": 5000, "status": "PASS"}
    })

    # ë¹„ìš© ë¶„ì„
    exp.save_cost_analysis({
        "llm_usage": {"total_tokens": 2345},
        "cost_breakdown_krw": {"total_cost": 30.51}
    })
```

#### 3.7 ê²°ê³¼ë¬¼ ì €ì¥

```python
with ExperimentManager() as exp:
    # ìµœì¢… ë‹µë³€ ì €ì¥
    exp.save_output('response.txt', final_answer)

    # ìš”ì•½ë³¸ ì €ì¥ (ìˆì„ ê²½ìš°)
    exp.save_output('summary.md', summary_text)

    # ì‚¬ìš©ì ì €ì¥ ìš”ì²­ íŒŒì¼
    exp.save_output('saved_file.txt', content)
```

---

### 4. ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„

#### 4.1 find_experiments ìŠ¤í¬ë¦½íŠ¸

**íŒŒì¼ ê²½ë¡œ**: `scripts/find_experiments.py`

```python
import json
from pathlib import Path
from typing import Optional, List, Dict


def find_experiments(
    difficulty: Optional[str] = None,
    tool: Optional[str] = None,
    date: Optional[str] = None,
    min_response_time: Optional[int] = None,
    max_response_time: Optional[int] = None
) -> List[Dict]:
    """
    ë©”íƒ€ë°ì´í„° ê¸°ë°˜ ì‹¤í—˜ ê²€ìƒ‰

    Args:
        difficulty: ë‚œì´ë„ í•„í„° (easy/hard)
        tool: ë„êµ¬ í•„í„° (rag_paper, web_search ë“±)
        date: ë‚ ì§œ í•„í„° (YYYYMMDD)
        min_response_time: ìµœì†Œ ì‘ë‹µ ì‹œê°„ (ms)
        max_response_time: ìµœëŒ€ ì‘ë‹µ ì‹œê°„ (ms)

    Returns:
        ê²€ìƒ‰ëœ ì‹¤í—˜ ëª©ë¡
    """
    results = []

    # ê²€ìƒ‰ ê²½ë¡œ
    if date:
        search_path = Path(f"experiments/{date}")
        if not search_path.exists():
            return []
    else:
        search_path = Path("experiments")

    # ëª¨ë“  metadata.json ì°¾ê¸°
    for meta_file in search_path.rglob("metadata.json"):
        try:
            with open(meta_file, encoding='utf-8') as f:
                meta = json.load(f)
        except Exception:
            continue

        # í•„í„° ì ìš©
        if difficulty and meta.get('difficulty') != difficulty:
            continue
        if tool and meta.get('tool_used') != tool:
            continue
        if min_response_time and meta.get('response_time_ms', 0) < min_response_time:
            continue
        if max_response_time and meta.get('response_time_ms', float('inf')) > max_response_time:
            continue

        results.append({
            'path': meta_file.parent,
            'metadata': meta
        })

    results.sort(key=lambda x: x['metadata'].get('start_time', ''))
    return results


if __name__ == "__main__":
    # ì‚¬ìš© ì˜ˆì‹œ
    easy_experiments = find_experiments(difficulty="easy")
    print(f"Easy ëª¨ë“œ ì‹¤í—˜: {len(easy_experiments)}ê°œ")

    for exp in easy_experiments:
        print(f"  - {exp['path'].name}: {exp['metadata']['user_query']}")
```

#### 4.2 í‰ê°€ ì§€í‘œ ì§‘ê³„

**íŒŒì¼ ê²½ë¡œ**: `scripts/aggregate_metrics.py`

```python
import json
from pathlib import Path
from typing import Dict


def aggregate_metrics(date: str) -> Dict:
    """
    íŠ¹ì • ë‚ ì§œì˜ ëª¨ë“  ì‹¤í—˜ í‰ê°€ ì§€í‘œ ì§‘ê³„

    Args:
        date: ë‚ ì§œ (YYYYMMDD)

    Returns:
        ì§‘ê³„ëœ í‰ê°€ ì§€í‘œ
    """
    metrics_list = []

    for session_dir in Path(f"experiments/{date}").glob("*_session_*"):
        rag_metrics_file = session_dir / "evaluation" / "rag_metrics.json"
        if rag_metrics_file.exists():
            with open(rag_metrics_file) as f:
                metrics_list.append(json.load(f))

    if not metrics_list:
        return {}

    # í‰ê·  ê³„ì‚°
    avg_recall = sum(m['retrieval_metrics']['recall_at_5'] for m in metrics_list) / len(metrics_list)
    avg_faithfulness = sum(m['generation_metrics']['faithfulness'] for m in metrics_list) / len(metrics_list)

    return {
        'total_sessions': len(metrics_list),
        'avg_recall_at_5': avg_recall,
        'avg_faithfulness': avg_faithfulness
    }


if __name__ == "__main__":
    # ì‚¬ìš© ì˜ˆì‹œ
    result = aggregate_metrics("20251031")
    print(f"ì´ ì„¸ì…˜: {result['total_sessions']}")
    print(f"í‰ê·  Recall@5: {result['avg_recall_at_5']:.2f}")
    print(f"í‰ê·  Faithfulness: {result['avg_faithfulness']:.2f}")
```

---

## ì°¸ê³  PRD ë¬¸ì„œ

ì•„ë˜ PRD ë¬¸ì„œë“¤ì„ ì°¸ê³ í•˜ì—¬ êµ¬í˜„í•˜ì„¸ìš”:

1. **[ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md](../references/ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md)** â­â­â­
   - ì „ì²´ í´ë” êµ¬ì¡° ìƒì„¸ ê°€ì´ë“œ
   - ExperimentManager ì „ì²´ ì½”ë“œ
   - ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ
   - íŒŒì¼ë³„ ìƒì„¸ ì„¤ëª…

2. **[06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md)** â­â­â­
   - ì‹¤í—˜ í´ë” ìƒì„± íë¦„
   - Session ID ìë™ ë¶€ì—¬ ê·œì¹™
   - ExperimentManager ì‚¬ìš©ë²•
   - ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„

3. **[09_í‰ê°€_ê¸°ì¤€.md](../PRD/09_í‰ê°€_ê¸°ì¤€.md)** â­â­
   - RAG í‰ê°€ ì§€í‘œ (Recall@K, Faithfulness ë“±)
   - Agent ì •í™•ë„ ì¸¡ì • ë°©ë²•
   - ì‘ë‹µ ì‹œê°„ ëª©í‘œ (p95 â‰¤ 6000ms)
   - ë¹„ìš© ë¶„ì„ ê¸°ì¤€

---

## í˜‘ì—… ë°©ë²•

### ë‹¤ë¥¸ ë‹´ë‹¹ìì™€ì˜ í˜‘ì—…

#### 1. ì „ì²´ íŒ€ì› - ExperimentManager ì‚¬ìš©
- **í˜‘ì—… ë‚´ìš©**: ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ ì‹œ ExperimentManager ì‚¬ìš©
- **íƒ€ì´ë°**: ExperimentManager êµ¬í˜„ ì™„ë£Œ ì¦‰ì‹œ
- **ì „ë‹¬ ì‚¬í•­**:
  - ExperimentManager ì‚¬ìš©ë²• ë¬¸ì„œ
  - with ë¬¸ ì‚¬ìš© ì˜ˆì‹œ
  - ë„êµ¬ë³„ Logger ì‚¬ìš©ë²•

#### 2. ìµœí˜„í™” (AI Agent ë©”ì¸) - Agentì— í†µí•©
- **í˜‘ì—… ë‚´ìš©**: LangGraph StateGraphì— ExperimentManager í†µí•©
- **íƒ€ì´ë°**: Agent graph êµ¬í˜„ ì™„ë£Œ í›„
- **ì „ë‹¬ ì‚¬í•­**:
  - ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸ ì‹œì 
  - ë„êµ¬ ì‹¤í–‰ ì‹œ Logger ì‚¬ìš©ë²•
  - í‰ê°€ ì§€í‘œ ì €ì¥ ì‹œì 

#### 3. ì„ì˜ˆìŠ¬ (UI/í”„ë¡¬í”„íŠ¸) - UI ì¸í„°ë™ì…˜ ë¡œê¹…
- **í˜‘ì—… ë‚´ìš©**: Streamlit UIì—ì„œ ExperimentManager ì‚¬ìš©
- **íƒ€ì´ë°**: UI êµ¬í˜„ ì‹œ
- **ì „ë‹¬ ì‚¬í•­**:
  - `log_ui_interaction()` ì‚¬ìš©ë²•
  - `log_ui_event()` ì‚¬ìš©ë²•
  - `save_streamlit_session()` ì‚¬ìš©ë²•

#### 4. ì‹ ì¤€ì—½ (RAG/ìš©ì–´ì§‘) - DB ì¿¼ë¦¬ ë¡œê¹…
- **í˜‘ì—… ë‚´ìš©**: RAG ê²€ìƒ‰ ì‹œ DB ì¿¼ë¦¬ ê¸°ë¡
- **íƒ€ì´ë°**: RAG ë„êµ¬ êµ¬í˜„ ì‹œ
- **ì „ë‹¬ ì‚¬í•­**:
  - `log_sql_query()` ì‚¬ìš©ë²•
  - `log_pgvector_search()` ì‚¬ìš©ë²•
  - `save_search_results()` ì‚¬ìš©ë²•

---

## êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ExperimentManager ê¸°ë³¸ êµ¬í˜„ (ìš°ì„ ìˆœìœ„ 1)
- [ ] `src/utils/experiment_manager.py` íŒŒì¼ ìƒì„±
- [ ] ExperimentManager í´ë˜ìŠ¤ ê¸°ë³¸ êµ¬ì¡° êµ¬í˜„
  - [ ] `__init__()` - Session ID ìë™ ë¶€ì—¬, í´ë” ìƒì„±
  - [ ] `_get_next_session_id()` - Session ID ìë™ ê³„ì‚°
  - [ ] `get_tool_logger()` - ë„êµ¬ë³„ Logger ì œê³µ
  - [ ] `update_metadata()` - ë©”íƒ€ë°ì´í„° ê´€ë¦¬
  - [ ] `save_config()` - ì„¤ì • ì €ì¥
  - [ ] `close()` - ì¢…ë£Œ ì²˜ë¦¬
  - [ ] `__enter__()`, `__exit__()` - with ë¬¸ ì§€ì›
- [ ] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë° ê²€ì¦
- [ ] ì‚¬ìš©ë²• ë¬¸ì„œí™” ë° íŒ€ì› ê³µìœ 

### Phase 2: DB ë° í”„ë¡¬í”„íŠ¸ ì €ì¥ êµ¬í˜„ (ìš°ì„ ìˆœìœ„ 2)
- [ ] DB ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `log_sql_query()` - SQL ì¿¼ë¦¬ ê¸°ë¡
  - [ ] `log_pgvector_search()` - pgvector ê²€ìƒ‰ ê¸°ë¡
  - [ ] `save_search_results()` - ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
  - [ ] `save_db_performance()` - DB ì„±ëŠ¥ ì €ì¥
- [ ] í”„ë¡¬í”„íŠ¸ ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_system_prompt()` - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸
  - [ ] `save_user_prompt()` - ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸
  - [ ] `save_final_prompt()` - ìµœì¢… í”„ë¡¬í”„íŠ¸
  - [ ] `save_prompt_template()` - í…œí”Œë¦¿ ì •ë³´
- [ ] í…ŒìŠ¤íŠ¸ ë° ê²€ì¦

### Phase 3: UI ë° í‰ê°€ ì§€í‘œ êµ¬í˜„ (ìš°ì„ ìˆœìœ„ 3)
- [ ] UI ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_streamlit_session()` - Streamlit ì„¸ì…˜
  - [ ] `log_ui_interaction()` - ì¸í„°ë™ì…˜ ë¡œê·¸
  - [ ] `log_ui_event()` - UI ì´ë²¤íŠ¸
- [ ] í‰ê°€ ì§€í‘œ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_rag_metrics()` - RAG í‰ê°€
  - [ ] `save_agent_accuracy()` - Agent ì •í™•ë„
  - [ ] `save_latency_report()` - ì‘ë‹µ ì‹œê°„
  - [ ] `save_cost_analysis()` - ë¹„ìš© ë¶„ì„
  - [ ] `save_test_results()` - í…ŒìŠ¤íŠ¸ ê²°ê³¼
- [ ] ì¶œë ¥ ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_output()` - ê²°ê³¼ë¬¼ ì €ì¥
- [ ] ë””ë²„ê·¸ ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_debug_info()` - ë””ë²„ê·¸ ì •ë³´

### Phase 4: ì‹¤í—˜ ê²€ìƒ‰ ë° ë¶„ì„ ë„êµ¬ (ì„ íƒ)
- [ ] `scripts/find_experiments.py` ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
  - [ ] `find_experiments()` í•¨ìˆ˜ êµ¬í˜„
  - [ ] ë‹¤ì–‘í•œ í•„í„° ì˜µì…˜ ì§€ì›
- [ ] `scripts/aggregate_metrics.py` ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±
  - [ ] `aggregate_metrics()` í•¨ìˆ˜ êµ¬í˜„
  - [ ] í‰ê°€ ì§€í‘œ ì§‘ê³„ ê¸°ëŠ¥
- [ ] ì‚¬ìš© ì˜ˆì‹œ ë° ë¬¸ì„œí™”

### Phase 5: ë¬¸ì„œí™” ë° í…ŒìŠ¤íŠ¸ (ì§€ì†)
- [ ] README.md ì—…ë°ì´íŠ¸ (ExperimentManager ì‚¬ìš©ë²•)
- [ ] ìƒ˜í”Œ ì½”ë“œ ì‘ì„±
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (`tests/utils/test_experiment_manager.py`)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸
- [ ] íŒ€ì› êµìœ¡ ë° ì‚¬ìš©ë²• ê³µìœ 

---

## ê·œì¹™ ë° ì£¼ì˜ì‚¬í•­

### 1. Session ID ìë™ ë¶€ì—¬ ê·œì¹™
- **í˜•ì‹**: `session_001`, `session_002`, `session_003` ...
- **ë¶€ì—¬ ë°©ì‹**: ë‹¹ì¼ ê¸°ì¤€ìœ¼ë¡œ ìˆœì°¨ì ìœ¼ë¡œ ì¦ê°€
- **ì‹œì‘ ë²ˆí˜¸**: ë§¤ì¼ `001`ë¶€í„° ì‹œì‘
- **ì¤‘ë³µ ë°©ì§€**: `_get_next_session_id()` ë©”ì„œë“œê°€ ìë™ ì²˜ë¦¬

### 2. í´ë” êµ¬ì¡° ê·œì¹™
- **í•„ìˆ˜ í´ë” 6ê°œ**: tools, database, prompts, ui, outputs, evaluation
- **ì„ íƒ í´ë” 1ê°œ**: debug (í•„ìš” ì‹œ ìƒì„±)
- **ë©”íƒ€ë°ì´í„°**: metadata.jsonì€ í•­ìƒ ìµœìƒìœ„ì— ìœ„ì¹˜
- **ë¡œê·¸ íŒŒì¼**: chatbot.logëŠ” ë©”ì¸ ë¡œê·¸, tools/*.logëŠ” ë„êµ¬ë³„ ë¡œê·¸

### 3. ì½”ë“œ í’ˆì§ˆ
- ëª¨ë“  ë©”ì„œë“œì— docstring ì‘ì„± (Args, Returns ëª…ì‹œ)
- íƒ€ì… íŒíŒ… ì‚¬ìš© (Python 3.10+)
- with ë¬¸ ì§€ì› (`__enter__`, `__exit__`)
- ë¦¬ì†ŒìŠ¤ ìë™ ì •ë¦¬ (`close()`)
- ì—ëŸ¬ ì²˜ë¦¬ ì² ì €íˆ (íŒŒì¼ I/O ì‹œ try-except)

### 4. í…ŒìŠ¤íŠ¸
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (`tests/utils/test_experiment_manager.py`)
- Session ID ì¤‘ë³µ ë°©ì§€ í…ŒìŠ¤íŠ¸
- í´ë” ìë™ ìƒì„± í…ŒìŠ¤íŠ¸
- ê° ì €ì¥ ë©”ì„œë“œ ê°œë³„ í…ŒìŠ¤íŠ¸
- with ë¬¸ ë™ì‘ í…ŒìŠ¤íŠ¸

### 5. ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­
- JSON íŒŒì¼ì€ ì €ì¥ ì‹œë§ˆë‹¤ ë®ì–´ì“°ê¸° (append ì•„ë‹˜)
- SQL ì¿¼ë¦¬ëŠ” append ë°©ì‹ (queries.sql)
- LoggerëŠ” ì¦‰ì‹œ flushí•˜ì—¬ ìœ ì‹¤ ë°©ì§€
- metadata.jsonì€ ë³€ê²½ ì‹œë§ˆë‹¤ ì—…ë°ì´íŠ¸

---

## ì˜ˆìƒ ê²°ê³¼ë¬¼

### 1. íŒŒì¼ êµ¬ì¡°

```
src/
â””â”€â”€ utils/
    â”œâ”€â”€ logger.py                  # Logger í´ë˜ìŠ¤ (ê¸°ì¡´)
    â””â”€â”€ experiment_manager.py      # ExperimentManager í´ë˜ìŠ¤ (ì‹ ê·œ)

scripts/
â”œâ”€â”€ find_experiments.py            # ì‹¤í—˜ ê²€ìƒ‰ ë„êµ¬ (ì‹ ê·œ)
â””â”€â”€ aggregate_metrics.py           # í‰ê°€ ì§€í‘œ ì§‘ê³„ (ì‹ ê·œ)

tests/
â””â”€â”€ utils/
    â””â”€â”€ test_experiment_manager.py # ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (ì‹ ê·œ)

experiments/                       # ì‹¤í—˜ ê²°ê³¼ í´ë”
â””â”€â”€ 20251031/
    â”œâ”€â”€ 20251031_103015_session_001/
    â”‚   â”œâ”€â”€ metadata.json
    â”‚   â”œâ”€â”€ chatbot.log
    â”‚   â”œâ”€â”€ config.yaml
    â”‚   â”œâ”€â”€ tools/
    â”‚   â”œâ”€â”€ database/
    â”‚   â”œâ”€â”€ prompts/
    â”‚   â”œâ”€â”€ ui/
    â”‚   â”œâ”€â”€ outputs/
    â”‚   â””â”€â”€ evaluation/
    â””â”€â”€ 20251031_110234_session_002/
        â””â”€â”€ ...
```

### 2. ì‚¬ìš© ì˜ˆì‹œ

**ê¸°ë³¸ ì‚¬ìš©:**
```python
from src.utils.experiment_manager import ExperimentManager

with ExperimentManager() as exp:
    exp.logger.write("ì±—ë´‡ ì‹¤í–‰ ì‹œì‘")
    exp.update_metadata(user_query="RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜")
    # ... ì±—ë´‡ ì‹¤í–‰ ...
```

**ë„êµ¬ë³„ Logger:**
```python
with ExperimentManager() as exp:
    tool_logger = exp.get_tool_logger('rag_paper')
    tool_logger.write("ë…¼ë¬¸ ê²€ìƒ‰ ì‹œì‘")
    tool_logger.close()
```

**í‰ê°€ ì§€í‘œ ì €ì¥:**
```python
with ExperimentManager() as exp:
    exp.save_rag_metrics({
        "retrieval_metrics": {"recall_at_5": 0.8},
        "generation_metrics": {"faithfulness": 0.95}
    })
```

**ì‹¤í—˜ ê²€ìƒ‰:**
```python
from scripts.find_experiments import find_experiments

# Easy ëª¨ë“œ ì‹¤í—˜ ì°¾ê¸°
easy_exps = find_experiments(difficulty="easy")

# ì‘ë‹µ ì‹œê°„ 3ì´ˆ ì´í•˜ ì‹¤í—˜ ì°¾ê¸°
fast_exps = find_experiments(max_response_time=3000)
```

---

## ì¶”ê°€ ì°¸ê³  ì‚¬í•­

### 1. metadata.json ì˜ˆì‹œ

```json
{
  "session_id": "001",
  "start_time": "2025-10-31T10:30:15",
  "end_time": "2025-10-31T10:32:45",
  "difficulty": "easy",
  "tool_used": "rag_paper",
  "user_query": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
  "success": true,
  "response_time_ms": 2500,
  "response_length": 450,
  "model": "gpt-4",
  "temperature": 0.7,
  "tokens_used": {
    "prompt": 1200,
    "completion": 800,
    "total": 2000
  },
  "db_queries_count": 4,
  "db_total_time_ms": 120
}
```

### 2. config.yaml ì˜ˆì‹œ

```yaml
# ì±—ë´‡ ì„¤ì •
difficulty: easy
model: gpt-4
temperature: 0.7
max_tokens: 2000

# RAG ì„¤ì •
top_k: 5
similarity_threshold: 0.7

# DB ì„¤ì •
database: papers
host: localhost
port: 5432
```

### 3. ì‹¤í—˜ ê²€ìƒ‰ ì¿¼ë¦¬ ì˜ˆì‹œ

```python
# ë‚œì´ë„ë³„ ê²€ìƒ‰
easy_experiments = find_experiments(difficulty="easy")
hard_experiments = find_experiments(difficulty="hard")

# ë„êµ¬ë³„ ê²€ìƒ‰
rag_experiments = find_experiments(tool="rag_paper")
web_experiments = find_experiments(tool="web_search")

# ë‚ ì§œë³„ ê²€ìƒ‰
today_experiments = find_experiments(date="20251031")

# ì‘ë‹µ ì‹œê°„ ê¸°ì¤€ ê²€ìƒ‰
fast_experiments = find_experiments(max_response_time=3000)
slow_experiments = find_experiments(min_response_time=5000)

# ë³µí•© ì¡°ê±´ ê²€ìƒ‰
filtered = find_experiments(
    difficulty="easy",
    tool="rag_paper",
    min_response_time=2000,
    max_response_time=5000
)
```
