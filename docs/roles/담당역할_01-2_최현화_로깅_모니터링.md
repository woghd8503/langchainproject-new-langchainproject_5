# ë‹´ë‹¹ì—­í• _01-2: ë¡œê¹… ë° ëª¨ë‹ˆí„°ë§ ì‹œìŠ¤í…œ

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-31
- **ìµœì¢… ìˆ˜ì •ì¼**: 2025-10-31
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±
- **ë‹´ë‹¹ ê¸°ëŠ¥**: ë¡œê¹… ì‹œìŠ¤í…œ, ì‹¤í—˜ ì¶”ì  ê´€ë¦¬, ExperimentManager êµ¬í˜„
- **ì°¸ê³ **: ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md, PRD 05/06 ê¸°ë°˜ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë¨

---

## ë‹´ë‹¹ì ì •ë³´

**ë‹´ë‹¹ì**: ìµœí˜„í™”[íŒ€ì¥]

**ì—­í• **: ë¡œê¹… ë° ì‹¤í—˜ ê´€ë¦¬ ì‹œìŠ¤í…œ êµ¬ì¶•

---

## ë‹´ë‹¹ ì—…ë¬´ ê°œìš”

ì´ ì—­í• ì€ í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ëŠ” **ë¡œê¹… ì‹œìŠ¤í…œ êµ¬ì¶•** ë° **ì‹¤í—˜ ìë™ ì¶”ì  ê´€ë¦¬** ê¸°ëŠ¥ì„ ë‹´ë‹¹í•©ë‹ˆë‹¤.

### ì£¼ìš” ì±…ì„

1. **Logger í´ë˜ìŠ¤ êµ¬í˜„** (`src/utils/logger.py`)
   - íƒ€ì„ìŠ¤íƒ¬í”„ ìë™ ì¶”ê°€
   - íŒŒì¼ ë° ì½˜ì†” ë™ì‹œ ì¶œë ¥
   - í‘œì¤€ ì¶œë ¥ ë¦¬ë””ë ‰ì…˜
   - tqdm ì§„í–‰ë¥  í‘œì‹œ í†µí•©

2. **ExperimentManager í´ë˜ìŠ¤ êµ¬í˜„** (`src/utils/experiment_manager.py`)
   - Session ID ìë™ ë¶€ì—¬ ì‹œìŠ¤í…œ
   - í•„ìˆ˜ ì„œë¸Œ í´ë” 6ê°œ ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation)
   - metadata.json ê¸°ë°˜ ì¶”ì 
   - í‰ê°€ ì§€í‘œ ìë™ ì €ì¥

3. **ì‹¤í—˜ í´ë” êµ¬ì¡° ê´€ë¦¬**
   - `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/` êµ¬ì¡° ìë™ ìƒì„±
   - ë„êµ¬ë³„ ë¡œê·¸, DB ì¿¼ë¦¬, í”„ë¡¬í”„íŠ¸, UI ì¸í„°ë™ì…˜ ê¸°ë¡
   - í‰ê°€ ì§€í‘œ ë° ê²°ê³¼ë¬¼ ì €ì¥

---

## ì°¸ì—¬ ê¸°ê°„ ë° ìš°ì„ ìˆœìœ„

### ì°¸ì—¬ ê¸°ê°„
- **ì „ì²´ ê¸°ê°„ ì°¸ì—¬** (2025-10-28 ~ 2025-11-06, 10ì¼)
- **ìš°ì„  ì‘ì—… ê¸°ê°„**: í”„ë¡œì íŠ¸ ì´ˆê¸° (10/28-10/30, 3ì¼)
  - Logger í´ë˜ìŠ¤ë¥¼ ë¨¼ì € êµ¬í˜„í•´ì•¼ ë‹¤ë¥¸ íŒ€ì›ë“¤ì´ ì‚¬ìš© ê°€ëŠ¥

### ìš°ì„ ìˆœìœ„
1. **ìµœìš°ì„  (Day 1-2)**: Logger í´ë˜ìŠ¤ êµ¬í˜„
2. **ìš°ì„  (Day 3-5)**: ExperimentManager í´ë˜ìŠ¤ êµ¬í˜„ (Session ID ìë™ ë¶€ì—¬, í´ë” ìë™ ìƒì„±)
3. **ì¤‘ìš” (Day 6-7)**: í‰ê°€ ì§€í‘œ ì €ì¥ ë©”ì„œë“œ êµ¬í˜„ (RAG, Agent, Latency, Cost)
4. **ì„ íƒ (Day 8+)**: ì‹¤í—˜ ê²€ìƒ‰ ìŠ¤í¬ë¦½íŠ¸, í‰ê°€ ì§€í‘œ ì§‘ê³„ ë„êµ¬

---

## ì„¸ë¶€ ì—…ë¬´ ë° êµ¬í˜„ ë‚´ìš©

### 1. Logger í´ë˜ìŠ¤ êµ¬í˜„

**íŒŒì¼ ê²½ë¡œ**: `src/utils/logger.py`

#### 1.1 í´ë˜ìŠ¤ êµ¬ì¡°

```python
import sys
from datetime import datetime
from pathlib import Path
from typing import Optional


class Logger:
    """
    í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ì‚¬ìš©í•˜ëŠ” ë¡œê¹… í´ë˜ìŠ¤

    ì£¼ìš” ê¸°ëŠ¥:
    - íƒ€ì„ìŠ¤íƒ¬í”„ ìë™ ì¶”ê°€
    - íŒŒì¼ ë° ì½˜ì†” ë™ì‹œ ì¶œë ¥
    - í‘œì¤€ ì¶œë ¥ ë¦¬ë””ë ‰ì…˜
    - tqdm ì§„í–‰ë¥  í‘œì‹œ í†µí•©
    """

    def __init__(self, log_path: str, print_also: bool = True):
        """
        Logger ì´ˆê¸°í™”

        Args:
            log_path: ë¡œê·¸ íŒŒì¼ ê²½ë¡œ (ì˜ˆ: "experiments/20251030/experiment.log")
            print_also: Trueë©´ ì½˜ì†”ì—ë„ ì¶œë ¥
        """
        self.log_path = Path(log_path)
        self.print_also = print_also

        # ë¡œê·¸ í´ë” ìƒì„±
        self.log_path.parent.mkdir(parents=True, exist_ok=True)

        # ë¡œê·¸ íŒŒì¼ ì—´ê¸°
        self.log_file = open(self.log_path, 'a', encoding='utf-8')

        # ë¦¬ë””ë ‰ì…˜ ë°±ì—…
        self._stdout_backup = None
        self._stderr_backup = None

    def write(self, message: str, print_also: Optional[bool] = None, print_error: bool = False):
        """
        ë¡œê·¸ ë©”ì‹œì§€ ê¸°ë¡

        Args:
            message: ê¸°ë¡í•  ë©”ì‹œì§€
            print_also: ì½˜ì†” ì¶œë ¥ ì—¬ë¶€ (Noneì´ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©)
            print_error: Trueë©´ ì—ëŸ¬ ë©”ì‹œì§€ë¡œ í‘œì‹œ (ë¹¨ê°„ìƒ‰)
        """
        # ë¹ˆ ë©”ì‹œì§€ ë¬´ì‹œ
        if not message or not message.strip():
            return

        # íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€
        timestamp = datetime.now().strftime('%Y-%m-%d %H:%M:%S')
        log_line = f"{timestamp} | {message}"

        # íŒŒì¼ì— ê¸°ë¡
        self.log_file.write(log_line + '\n')
        self.log_file.flush()

        # ì½˜ì†” ì¶œë ¥
        should_print = print_also if print_also is not None else self.print_also
        if should_print:
            if print_error:
                # ì—ëŸ¬ ë©”ì‹œì§€ëŠ” ë¹¨ê°„ìƒ‰ìœ¼ë¡œ
                print(f"\033[91m{log_line}\033[0m")
            else:
                print(log_line)

    def start_redirect(self):
        """í‘œì¤€ ì¶œë ¥/ì—ëŸ¬ë¥¼ ë¡œê·¸ íŒŒì¼ë¡œ ë¦¬ë””ë ‰ì…˜ ì‹œì‘"""
        self._stdout_backup = sys.stdout
        self._stderr_backup = sys.stderr

        sys.stdout = self
        sys.stderr = self

    def stop_redirect(self):
        """í‘œì¤€ ì¶œë ¥/ì—ëŸ¬ ë¦¬ë””ë ‰ì…˜ ì¤‘ì§€"""
        if self._stdout_backup:
            sys.stdout = self._stdout_backup
        if self._stderr_backup:
            sys.stderr = self._stderr_backup

    def tqdm_redirect(self):
        """tqdm ì§„í–‰ë¥  í‘œì‹œë¥¼ ë¡œê·¸ë¡œ ë¦¬ë””ë ‰ì…˜"""
        try:
            from tqdm import tqdm
            # tqdmì˜ file íŒŒë¼ë¯¸í„°ë¥¼ í˜„ì¬ Loggerë¡œ ì„¤ì •
            return tqdm
        except ImportError:
            self.write("tqdmì´ ì„¤ì¹˜ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.", print_error=True)
            return None

    def flush(self):
        """ë²„í¼ í”ŒëŸ¬ì‹œ"""
        self.log_file.flush()

    def close(self):
        """ë¡œê·¸ íŒŒì¼ ë‹«ê¸°"""
        if hasattr(self, 'log_file') and self.log_file:
            self.log_file.close()

    def __del__(self):
        """ì†Œë©¸ì - íŒŒì¼ ìë™ ë‹«ê¸°"""
        self.close()
```

#### 1.2 ì‚¬ìš© ì˜ˆì‹œ

```python
import os
from datetime import datetime
from src.utils.logger import Logger

# ë¡œê·¸ í´ë” ê²½ë¡œ ìƒì„±
today = datetime.now().strftime("%Y%m%d")
time_now = datetime.now().strftime("%H%M%S")
experiment_name = "rag_vectordb_build"

# ì‹¤í—˜ í´ë” ìƒì„±
log_dir = f"experiments/{today}/{today}_{time_now}_{experiment_name}"
os.makedirs(log_dir, exist_ok=True)

# Logger ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
logger = Logger(
    log_path=f"{log_dir}/experiment.log",
    print_also=True  # ì½˜ì†”ì—ë„ ì¶œë ¥
)

# ë¡œê·¸ ê¸°ë¡
logger.write("VectorDB êµ¬ì¶• ì‹œì‘")
logger.write(f"ì´ {len(documents)}ê°œ ë¬¸ì„œ ë¡œë“œ ì™„ë£Œ")

# ì—ëŸ¬ ë©”ì‹œì§€ (ë¹¨ê°„ìƒ‰)
logger.write("ì˜¤ë¥˜: íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.", print_error=True)

# Logger ì¢…ë£Œ
logger.close()
```

#### 1.3 í‘œì¤€ ì¶œë ¥ ë¦¬ë””ë ‰ì…˜

```python
logger = Logger(f"{log_dir}/training.log")

# ë¦¬ë””ë ‰ì…˜ ì‹œì‘
logger.start_redirect()

# ì´ì œ printë„ ìë™ìœ¼ë¡œ ë¡œê·¸ì— ê¸°ë¡ë¨
print("ì´ ë©”ì‹œì§€ëŠ” ë¡œê·¸ íŒŒì¼ì— ì €ì¥ë©ë‹ˆë‹¤.")

# ë¦¬ë””ë ‰ì…˜ ì¤‘ì§€
logger.stop_redirect()

logger.close()
```

---

### 2. ExperimentManager í´ë˜ìŠ¤ êµ¬í˜„

**ëª©ì **: ì±—ë´‡ ì‹¤í–‰ë§ˆë‹¤ ìë™ìœ¼ë¡œ í´ë” êµ¬ì¡°ë¥¼ ìƒì„±í•˜ê³  ëª¨ë“  ì‹¤í–‰ ë‚´ìš©ì„ ì²´ê³„ì ìœ¼ë¡œ ê¸°ë¡

#### 2.1 í´ë˜ìŠ¤ êµ¬ì¡°

**íŒŒì¼ ê²½ë¡œ**: `src/utils/experiment_manager.py`

ì „ì²´ êµ¬í˜„ ì½”ë“œëŠ” `docs/references/ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md`ì™€ `docs/roles/ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md`ë¥¼ ì°¸ê³ í•˜ì„¸ìš”.

**ì£¼ìš” ê¸°ëŠ¥:**
- Session ID ìë™ ë¶€ì—¬ (session_001, 002, ...)
- í•„ìˆ˜ ì„œë¸Œ í´ë” 6ê°œ ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation)
- debug í´ë”ëŠ” í•„ìš”ì‹œ ìƒì„± (ì„ íƒ)
- metadata.json ê¸°ë°˜ ì¶”ì 
- ë„êµ¬ë³„ Logger ìƒì„±
- DB ì¿¼ë¦¬ ë° pgvector ê²€ìƒ‰ ê¸°ë¡
- í”„ë¡¬í”„íŠ¸ ì €ì¥ (system, user, final)
- UI ì¸í„°ë™ì…˜ ê¸°ë¡
- í‰ê°€ ì§€í‘œ ì €ì¥ (RAG, Agent, Latency, Cost)
- with ë¬¸ ì§€ì› (__enter__, __exit__)

#### 2.2 í´ë” êµ¬ì¡°

```
experiments/
â””â”€â”€ 20251031/                                # ë‚ ì§œ (YYYYMMDD)
    â””â”€â”€ 20251031_103015_session_001/         # ì‹œê°„_session_ID
        â”‚
        â”œâ”€â”€ metadata.json                    # â­ ì „ì²´ ì‹¤í—˜ ë©”íƒ€ë°ì´í„°
        â”œâ”€â”€ chatbot.log                      # ë©”ì¸ ì‹¤í–‰ ë¡œê·¸
        â”œâ”€â”€ config.yaml                      # ì „ì²´ ì„¤ì •
        â”‚
        â”œâ”€â”€ tools/                           # ğŸ”§ ë„êµ¬ ì‹¤í–‰ ë¡œê·¸
        â”‚   â”œâ”€â”€ rag_paper.log
        â”‚   â”œâ”€â”€ rag_glossary.log
        â”‚   â”œâ”€â”€ web_search.log
        â”‚   â”œâ”€â”€ summary_paper.log
        â”‚   â”œâ”€â”€ file_save.log
        â”‚   â””â”€â”€ general.log
        â”‚
        â”œâ”€â”€ database/                        # ğŸ—„ï¸ DB ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ queries.sql
        â”‚   â”œâ”€â”€ pgvector_searches.json
        â”‚   â”œâ”€â”€ search_results.json
        â”‚   â””â”€â”€ db_performance.json
        â”‚
        â”œâ”€â”€ prompts/                         # ğŸ’¬ í”„ë¡¬í”„íŠ¸ ê¸°ë¡
        â”‚   â”œâ”€â”€ system_prompt.txt
        â”‚   â”œâ”€â”€ user_prompt.txt
        â”‚   â”œâ”€â”€ final_prompt.txt
        â”‚   â””â”€â”€ prompt_template.yaml
        â”‚
        â”œâ”€â”€ ui/                              # ğŸ–¥ï¸ UI ê´€ë ¨ ê¸°ë¡
        â”‚   â”œâ”€â”€ streamlit_session.json
        â”‚   â”œâ”€â”€ user_interactions.log
        â”‚   â””â”€â”€ ui_events.json
        â”‚
        â”œâ”€â”€ outputs/                         # ğŸ“„ ìƒì„±ëœ ê²°ê³¼ë¬¼
        â”‚   â”œâ”€â”€ response.txt
        â”‚   â”œâ”€â”€ summary.md
        â”‚   â””â”€â”€ saved_file.txt
        â”‚
        â”œâ”€â”€ evaluation/                      # ğŸ“Š í‰ê°€ ì§€í‘œ
        â”‚   â”œâ”€â”€ rag_metrics.json
        â”‚   â”œâ”€â”€ agent_accuracy.json
        â”‚   â”œâ”€â”€ latency_report.json
        â”‚   â”œâ”€â”€ cost_analysis.json
        â”‚   â””â”€â”€ test_results.json
        â”‚
        â””â”€â”€ debug/                           # ğŸ› ë””ë²„ê·¸ ì •ë³´ (ì„ íƒ)
            â”œâ”€â”€ agent_trace.json
            â”œâ”€â”€ llm_tokens.json
            â””â”€â”€ error_trace.log
```

#### 2.3 Session ID ìë™ ë¶€ì—¬

Session IDëŠ” **ë‹¹ì¼ ê¸°ì¤€ìœ¼ë¡œ ìë™ ë¶€ì—¬**ë©ë‹ˆë‹¤:

- **í˜•ì‹**: `session_001`, `session_002`, `session_003` ...
- **ë¶€ì—¬ ë°©ì‹**: ë‹¹ì¼ í´ë”ì˜ ê¸°ì¡´ session í™•ì¸ í›„ ë‹¤ìŒ ë²ˆí˜¸
- **ì‹œì‘ ë²ˆí˜¸**: ë§¤ì¼ `001`ë¶€í„° ì‹œì‘

**ì˜ˆì‹œ:**
```
experiments/20251031/
â”œâ”€â”€ 20251031_103015_session_001/   # ì˜¤ëŠ˜ ì²« ë²ˆì§¸
â”œâ”€â”€ 20251031_110234_session_002/   # ì˜¤ëŠ˜ ë‘ ë²ˆì§¸
â””â”€â”€ 20251031_143520_session_003/   # ì˜¤ëŠ˜ ì„¸ ë²ˆì§¸

experiments/20251101/
â””â”€â”€ 20251101_090012_session_001/   # ë‹¤ìŒ ë‚ , ë‹¤ì‹œ 001ë¶€í„°
```

#### 2.4 ExperimentManager í•µì‹¬ ë©”ì„œë“œ

```python
class ExperimentManager:
    """ì‹¤í—˜ í´ë” ìƒì„± ë° ê´€ë¦¬ í´ë˜ìŠ¤"""

    def __init__(self):
        """Session ID ìë™ ë¶€ì—¬ ë° í´ë” ìƒì„±"""
        # ë‚ ì§œ/ì‹œê°„ ìƒì„± ë° Session ID ë¶€ì—¬
        # í•„ìˆ˜ ì„œë¸Œ í´ë” 6ê°œ ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation)
        # debug í´ë”ëŠ” í•„ìš”ì‹œ ìƒì„± (ì„ íƒ)
        # metadata.json ì´ˆê¸°í™”
        # Logger ì´ˆê¸°í™”

    # ===== ë„êµ¬ ë¡œê·¸ =====
    def get_tool_logger(self, tool_name: str) -> Logger:
        """ë„êµ¬ë³„ Logger ìƒì„±"""

    # ===== DB ê´€ë ¨ =====
    def log_sql_query(self, query: str, description: str, tool: str, execution_time_ms: int):
        """SQL ì¿¼ë¦¬ ê¸°ë¡"""

    def log_pgvector_search(self, search_info: Dict):
        """pgvector ê²€ìƒ‰ ê¸°ë¡"""

    def save_search_results(self, tool_name: str, results: Dict):
        """DB ê²€ìƒ‰ ê²°ê³¼ ì €ì¥"""

    def save_db_performance(self, performance_data: Dict):
        """DB ì„±ëŠ¥ ì •ë³´ ì €ì¥"""

    # ===== í”„ë¡¬í”„íŠ¸ ê´€ë ¨ =====
    def save_system_prompt(self, system_prompt: str, metadata: Dict):
        """ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥"""

    def save_user_prompt(self, user_prompt: str, metadata: Dict):
        """ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥"""

    def save_final_prompt(self, final_prompt: str, metadata: Dict):
        """ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥"""

    def save_prompt_template(self, template_info: Dict):
        """í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿ ì •ë³´ ì €ì¥"""

    # ===== UI ê´€ë ¨ =====
    def save_streamlit_session(self, session_data: Dict):
        """Streamlit ì„¸ì…˜ ìƒíƒœ ì €ì¥"""

    def log_ui_interaction(self, interaction: str):
        """UI ì¸í„°ë™ì…˜ ë¡œê·¸"""

    def log_ui_event(self, event: Dict):
        """UI ì´ë²¤íŠ¸ ê¸°ë¡"""

    # ===== ì¶œë ¥ ê´€ë ¨ =====
    def save_output(self, filename: str, content: str):
        """ê²°ê³¼ë¬¼ ì €ì¥"""

    # ===== í‰ê°€ ì§€í‘œ ê´€ë ¨ =====
    def save_rag_metrics(self, metrics: Dict):
        """RAG í‰ê°€ ì§€í‘œ ì €ì¥"""

    def save_agent_accuracy(self, accuracy_data: Dict):
        """Agent ì •í™•ë„ ì €ì¥"""

    def save_latency_report(self, latency_data: Dict):
        """ì‘ë‹µ ì‹œê°„ ë¶„ì„ ì €ì¥"""

    def save_cost_analysis(self, cost_data: Dict):
        """ë¹„ìš© ë¶„ì„ ì €ì¥"""

    def save_test_results(self, test_data: Dict):
        """í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥"""

    # ===== ë©”íƒ€ë°ì´í„° ê´€ë ¨ =====
    def update_metadata(self, **kwargs):
        """ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸"""

    def save_config(self, config: Dict):
        """ì „ì²´ ì„¤ì • ì €ì¥"""

    def close(self):
        """ì‹¤í—˜ ì¢…ë£Œ"""

    def __enter__(self):
        """with ë¬¸ ì§€ì›"""
        return self

    def __exit__(self, exc_type, exc_val, exc_tb):
        """with ë¬¸ ì¢…ë£Œ ì‹œ ìë™ close"""
        self.close()
```

---

### 3. ì‚¬ìš© ì˜ˆì‹œ

#### 3.1 ê¸°ë³¸ ì‚¬ìš© (with ë¬¸)

```python
from src.utils.experiment_manager import ExperimentManager

# with ë¬¸ìœ¼ë¡œ ìë™ ì´ˆê¸°í™” ë° ì¢…ë£Œ
with ExperimentManager() as exp:
    # ìë™ìœ¼ë¡œ ë‹¤ìŒ ì‘ì—… ìˆ˜í–‰:
    # 1. experiments/20251031/20251031_103015_session_001/ ìƒì„±
    # 2. Session ID ìë™ ë¶€ì—¬ (session_001, 002...)
    # 3. chatbot.log íŒŒì¼ ìƒì„±
    # 4. í•„ìˆ˜ ì„œë¸Œ í´ë” 6ê°œ ìƒì„± (tools, database, prompts, ui, outputs, evaluation)
    # 5. metadata.json ì´ˆê¸°í™”
    # 6. Logger ì´ˆê¸°í™”

    # ë©”ì¸ ë¡œê·¸ ê¸°ë¡
    exp.logger.write("ì±—ë´‡ ì‹¤í–‰ ì‹œì‘")
    exp.logger.write("ì‚¬ìš©ì ì§ˆë¬¸: RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜")

    # ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
    exp.update_metadata(
        user_query="RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
        difficulty="easy"
    )

    # with ë¸”ë¡ì´ ëë‚˜ë©´ ìë™ìœ¼ë¡œ Logger ì¢…ë£Œ
```

#### 3.2 ë„êµ¬ë³„ Logger ì‚¬ìš©

```python
with ExperimentManager() as exp:
    # ë„êµ¬ë³„ Logger ìƒì„±
    rag_logger = exp.get_tool_logger('rag_paper')
    rag_logger.write("ë…¼ë¬¸ ê²€ìƒ‰ ì‹œì‘")
    rag_logger.write("ê²€ìƒ‰ ì™„ë£Œ: 5ê°œ ë…¼ë¬¸ ë°œê²¬")
    rag_logger.close()

    # ë‹¤ë¥¸ ë„êµ¬
    web_logger = exp.get_tool_logger('web_search')
    web_logger.write("ì›¹ ê²€ìƒ‰ ì‹œì‘")
    web_logger.close()
```

#### 3.3 DB ì¿¼ë¦¬ ë° í”„ë¡¬í”„íŠ¸ ì €ì¥

```python
with ExperimentManager() as exp:
    # SQL ì¿¼ë¦¬ ê¸°ë¡
    exp.log_sql_query(
        query="SELECT * FROM papers WHERE paper_id IN (1, 2, 3)",
        description="ë…¼ë¬¸ ë©”íƒ€ë°ì´í„° ì¡°íšŒ",
        tool="rag_paper",
        execution_time_ms=12
    )

    # pgvector ê²€ìƒ‰ ê¸°ë¡
    exp.log_pgvector_search({
        "tool": "rag_paper",
        "collection": "paper_chunks",
        "query_text": "RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
        "top_k": 5,
        "execution_time_ms": 45
    })

    # í”„ë¡¬í”„íŠ¸ ì €ì¥
    exp.save_system_prompt(
        system_prompt="ë‹¹ì‹ ì€ ë…¼ë¬¸ì„ ì‰½ê²Œ ì„¤ëª…í•˜ëŠ” ì „ë¬¸ê°€ì…ë‹ˆë‹¤.",
        metadata={"ë‚œì´ë„": "easy"}
    )

    exp.save_user_prompt(
        user_prompt="[ì§ˆë¬¸]\nRAGì— ëŒ€í•´ ì•Œë ¤ì¤˜",
        metadata={"ê²€ìƒ‰ ê²°ê³¼ ìˆ˜": 5}
    )
```

#### 3.4 í‰ê°€ ì§€í‘œ ì €ì¥

```python
with ExperimentManager() as exp:
    # RAG í‰ê°€ ì§€í‘œ
    exp.save_rag_metrics({
        "retrieval_metrics": {
            "recall_at_5": 0.8,
            "precision_at_5": 0.4
        },
        "generation_metrics": {
            "faithfulness": 0.95
        }
    })

    # Agent ì •í™•ë„
    exp.save_agent_accuracy({
        "routing_decision": {
            "predicted_tool": "rag_paper",
            "correct": True
        }
    })

    # ì‘ë‹µ ì‹œê°„ ë¶„ì„
    exp.save_latency_report({
        "total_latency": {
            "total_time_ms": 5000,
            "status": "PASS"
        }
    })

    # ë¹„ìš© ë¶„ì„
    exp.save_cost_analysis({
        "llm_usage": {"total_tokens": 2345},
        "cost_breakdown_krw": {"total_cost": 30.51}
    })
```

---

## ì°¸ê³  PRD ë¬¸ì„œ

ì•„ë˜ PRD ë¬¸ì„œë“¤ì„ ì°¸ê³ í•˜ì—¬ êµ¬í˜„í•˜ì„¸ìš”:

1. **[05_ë¡œê¹…_ì‹œìŠ¤í…œ.md](../PRD/05_ë¡œê¹…_ì‹œìŠ¤í…œ.md)** â­â­â­
   - Logger í´ë˜ìŠ¤ ìƒì„¸ ëª…ì„¸
   - ExperimentManager ì‚¬ìš©ë²•
   - ë¡œê¹… ì •ì±… ë° ê·œì¹™

2. **[06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md](../PRD/06_ì‹¤í—˜_ì¶”ì _ê´€ë¦¬.md)** â­â­â­
   - ì‹¤í—˜ í´ë” êµ¬ì¡°
   - Session ID ìë™ ë¶€ì—¬ ê·œì¹™
   - metadata.json êµ¬ì¡°

3. **[09_í‰ê°€_ê¸°ì¤€.md](../PRD/09_í‰ê°€_ê¸°ì¤€.md)** â­â­
   - RAG í‰ê°€ ì§€í‘œ
   - Agent ì •í™•ë„
   - ì‘ë‹µ ì‹œê°„ ë° ë¹„ìš© ë¶„ì„

4. **[ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md](../references/ì‹¤í—˜_í´ë”_êµ¬ì¡°_ìµœì¢…ì•ˆ.md)** â­â­â­
   - ì „ì²´ í´ë” êµ¬ì¡° ìƒì„¸ ê°€ì´ë“œ
   - ExperimentManager ì „ì²´ êµ¬í˜„ ì½”ë“œ
   - ì‹¤ì œ ì‚¬ìš© ì˜ˆì‹œ

5. **[ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md](./ë‹´ë‹¹ì—­í• _01-1_ìµœí˜„í™”_ì‹¤í—˜_ê´€ë¦¬_ì‹œìŠ¤í…œ.md)** â­â­â­
   - ExperimentManager êµ¬í˜„ ë‹´ë‹¹ ì—­í• 
   - 7ê°€ì§€ ì‚¬ìš© ì˜ˆì‹œ
   - êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

6. **[ë‹´ë‹¹ì—­í• _06_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md](./ë‹´ë‹¹ì—­í• _06_ë¡œê¹…_ëª¨ë‹ˆí„°ë§.md)** â­â­
   - Logger ë° query_logs í…Œì´ë¸” êµ¬í˜„
   - ë ˆê±°ì‹œ ë¡œê¹… ì‹œìŠ¤í…œ ì°¸ê³ 

---

## í˜‘ì—… ë°©ë²•

### ë‹¤ë¥¸ ë‹´ë‹¹ìì™€ì˜ í˜‘ì—…

#### 1. ì „ì²´ íŒ€ì› - Logger ë° ExperimentManager ì‚¬ìš©
- **í˜‘ì—… ë‚´ìš©**: ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ ì‹œ ExperimentManager ì‚¬ìš©
- **íƒ€ì´ë°**: Logger êµ¬í˜„ ì™„ë£Œ ì¦‰ì‹œ
- **ì „ë‹¬ ì‚¬í•­**: Logger ë° ExperimentManager ì‚¬ìš©ë²• ë¬¸ì„œí™”, ì˜ˆì‹œ ì½”ë“œ

#### 2. AI Agent ë‹´ë‹¹ - Agent ì‹¤í–‰ ë¡œê¹… í†µí•©
- **í˜‘ì—… ë‚´ìš©**: Agent ì‹¤í–‰ ì‹œ ExperimentManagerë¡œ ìë™ ê¸°ë¡
- **íƒ€ì´ë°**: Agent graph êµ¬í˜„ ì™„ë£Œ í›„
- **ì „ë‹¬ ì‚¬í•­**: with ExperimentManager() as exp ì‚¬ìš© íŒ¨í„´

#### 3. RAG ë‹´ë‹¹ - DB ì¿¼ë¦¬ ë° ê²€ìƒ‰ ê²°ê³¼ ê¸°ë¡
- **í˜‘ì—… ë‚´ìš©**: pgvector ê²€ìƒ‰ ë° DB ì¿¼ë¦¬ ê¸°ë¡
- **íƒ€ì´ë°**: RAG Retriever êµ¬í˜„ ì™„ë£Œ í›„
- **ì „ë‹¬ ì‚¬í•­**: log_sql_query, log_pgvector_search ë©”ì„œë“œ ì‚¬ìš©ë²•

#### 4. UI ë‹´ë‹¹ - Streamlit ì¸í„°ë™ì…˜ ê¸°ë¡
- **í˜‘ì—… ë‚´ìš©**: UI ì´ë²¤íŠ¸ ë° ì„¸ì…˜ ìƒíƒœ ì €ì¥
- **íƒ€ì´ë°**: Streamlit UI êµ¬í˜„ ì™„ë£Œ í›„
- **ì „ë‹¬ ì‚¬í•­**: log_ui_interaction, save_streamlit_session ë©”ì„œë“œ ì‚¬ìš©ë²•

---

## êµ¬í˜„ ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: Logger í´ë˜ìŠ¤ êµ¬í˜„ (ìš°ì„ ìˆœìœ„ 1, Day 1-2)
- [ ] `src/utils/logger.py` íŒŒì¼ ìƒì„±
- [ ] Logger í´ë˜ìŠ¤ êµ¬í˜„
  - [ ] `__init__()` - íŒŒì¼ ì—´ê¸°, í´ë” ìƒì„±
  - [ ] `write()` - íƒ€ì„ìŠ¤íƒ¬í”„ ì¶”ê°€, íŒŒì¼/ì½˜ì†” ì¶œë ¥
  - [ ] `start_redirect()`, `stop_redirect()` - í‘œì¤€ ì¶œë ¥ ë¦¬ë””ë ‰ì…˜
  - [ ] `tqdm_redirect()` - tqdm í†µí•©
  - [ ] `flush()`, `close()` - íŒŒì¼ ê´€ë¦¬
- [ ] í…ŒìŠ¤íŠ¸ ìŠ¤í¬ë¦½íŠ¸ ì‘ì„± ë° ê²€ì¦
- [ ] ì‚¬ìš©ë²• ë¬¸ì„œí™” ë° íŒ€ì› ê³µìœ 

### Phase 2: ExperimentManager ê¸°ë³¸ êµ¬í˜„ (ìš°ì„ ìˆœìœ„ 2, Day 3-5)
- [ ] `src/utils/experiment_manager.py` íŒŒì¼ ìƒì„±
- [ ] ExperimentManager í´ë˜ìŠ¤ ê¸°ë³¸ êµ¬í˜„
  - [ ] `__init__()` - Session ID ìë™ ë¶€ì—¬, í´ë” ìƒì„±
  - [ ] `_get_next_session_id()` - Session ID ìë™ ì¦ê°€
  - [ ] `get_tool_logger()` - ë„êµ¬ë³„ Logger ìƒì„±
  - [ ] `update_metadata()` - ë©”íƒ€ë°ì´í„° ì—…ë°ì´íŠ¸
  - [ ] `save_config()` - ì„¤ì • ì €ì¥
  - [ ] `close()` - ì‹¤í—˜ ì¢…ë£Œ
  - [ ] `__enter__()`, `__exit__()` - with ë¬¸ ì§€ì›
- [ ] metadata.json ìë™ ìƒì„± ë° ì—…ë°ì´íŠ¸
- [ ] í•„ìˆ˜ ì„œë¸Œ í´ë” 6ê°œ ìë™ ìƒì„± (tools, database, prompts, ui, outputs, evaluation)

### Phase 3: DB ë° í”„ë¡¬í”„íŠ¸ ì €ì¥ (ìš°ì„ ìˆœìœ„ 2, Day 5-6)
- [ ] DB ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `log_sql_query()` - SQL ì¿¼ë¦¬ ê¸°ë¡
  - [ ] `log_pgvector_search()` - pgvector ê²€ìƒ‰ ê¸°ë¡
  - [ ] `save_search_results()` - ê²€ìƒ‰ ê²°ê³¼ ì €ì¥
  - [ ] `save_db_performance()` - DB ì„±ëŠ¥ ì €ì¥
- [ ] í”„ë¡¬í”„íŠ¸ ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_system_prompt()` - ì‹œìŠ¤í…œ í”„ë¡¬í”„íŠ¸ ì €ì¥
  - [ ] `save_user_prompt()` - ì‚¬ìš©ì í”„ë¡¬í”„íŠ¸ ì €ì¥
  - [ ] `save_final_prompt()` - ìµœì¢… í”„ë¡¬í”„íŠ¸ ì €ì¥
  - [ ] `save_prompt_template()` - í…œí”Œë¦¿ ì •ë³´ ì €ì¥

### Phase 4: UI ë° í‰ê°€ ì§€í‘œ (ì¤‘ìš”, Day 6-7)
- [ ] UI ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_streamlit_session()` - ì„¸ì…˜ ìƒíƒœ ì €ì¥
  - [ ] `log_ui_interaction()` - ì¸í„°ë™ì…˜ ë¡œê·¸
  - [ ] `log_ui_event()` - ì´ë²¤íŠ¸ ê¸°ë¡
- [ ] í‰ê°€ ì§€í‘œ ì €ì¥ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_rag_metrics()` - RAG í‰ê°€ ì§€í‘œ
  - [ ] `save_agent_accuracy()` - Agent ì •í™•ë„
  - [ ] `save_latency_report()` - ì‘ë‹µ ì‹œê°„ ë¶„ì„
  - [ ] `save_cost_analysis()` - ë¹„ìš© ë¶„ì„
  - [ ] `save_test_results()` - í…ŒìŠ¤íŠ¸ ê²°ê³¼
- [ ] ì¶œë ¥ ê´€ë ¨ ë©”ì„œë“œ êµ¬í˜„
  - [ ] `save_output()` - ê²°ê³¼ë¬¼ ì €ì¥

### Phase 5: ì‹¤í—˜ ê²€ìƒ‰ ë° ì§‘ê³„ (ì„ íƒ, Day 8+)
- [ ] `scripts/find_experiments.py` êµ¬í˜„
  - [ ] metadata.json ê¸°ë°˜ ê²€ìƒ‰ í•¨ìˆ˜
  - [ ] í•„í„°ë§ ì˜µì…˜ (ë‚œì´ë„, ë„êµ¬, ë‚ ì§œ, ì‘ë‹µ ì‹œê°„)
- [ ] `scripts/aggregate_metrics.py` êµ¬í˜„
  - [ ] í‰ê°€ ì§€í‘œ ìˆ˜ì§‘ ë° ì§‘ê³„
  - [ ] í‰ê· /ìµœì†Œ/ìµœëŒ€ê°’ ê³„ì‚°
  - [ ] CSV/JSON ê²°ê³¼ ì €ì¥

### Phase 6: ë¬¸ì„œí™” ë° í…ŒìŠ¤íŠ¸ (ì§€ì†)
- [ ] README.md ì—…ë°ì´íŠ¸ (ExperimentManager ì‚¬ìš©ë²•)
- [ ] ìƒ˜í”Œ ì½”ë“œ ì‘ì„±
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (`tests/utils/test_experiment_manager.py`)
- [ ] í†µí•© í…ŒìŠ¤íŠ¸

---

## ê·œì¹™ ë° ì£¼ì˜ì‚¬í•­

### 1. ë¡œê¹… ê·œì¹™
- **ëª¨ë“  ì±—ë´‡ ì‹¤í–‰ì€ ExperimentManagerë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë¡**
- `print()` ì‚¬ìš© ê¸ˆì§€ â†’ `logger.write()` ì‚¬ìš©
- ë¡œê·¸ íŒŒì¼ì€ `experiments/ë‚ ì§œ/ë‚ ì§œ_ì‹œê°„_session_XXX/` êµ¬ì¡°ë¡œ ìë™ ì €ì¥

### 2. Session ID ê·œì¹™
- **í˜•ì‹**: `session_001`, `session_002`, `session_003` ...
- **ìë™ ë¶€ì—¬**: ë‹¹ì¼ í´ë”ì˜ ê¸°ì¡´ session í™•ì¸ í›„ ë‹¤ìŒ ë²ˆí˜¸
- **ì‹œì‘ ë²ˆí˜¸**: ë§¤ì¼ `001`ë¶€í„° ì‹œì‘

### 3. ì½”ë“œ í’ˆì§ˆ
- ëª¨ë“  í´ë˜ìŠ¤ì™€ í•¨ìˆ˜ì— docstring ì‘ì„±
- íƒ€ì… íŒíŒ… ì‚¬ìš© (Python 3.10+)
- ì—ëŸ¬ ì²˜ë¦¬ ì² ì €íˆ (try-except)
- ë¦¬ì†ŒìŠ¤ ìë™ ì •ë¦¬ (`__del__`, `close()`)

### 4. í…ŒìŠ¤íŠ¸
- ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„± (`tests/utils/test_logger.py`, `tests/utils/test_experiment_manager.py`)
- ExperimentManagerëŠ” í”„ë¡œì íŠ¸ ì „ì²´ì—ì„œ ì‚¬ìš©ë˜ë¯€ë¡œ ì² ì €í•œ í…ŒìŠ¤íŠ¸ í•„ìš”
- Session ID ìë™ ë¶€ì—¬ ë¡œì§ í…ŒìŠ¤íŠ¸ í•„ìˆ˜

### 5. ì„±ëŠ¥ ê³ ë ¤ì‚¬í•­
- ë¡œê·¸ íŒŒì¼ì€ ë²„í¼ë§ ì‚¬ìš© (`flush()` ì ì ˆíˆ í˜¸ì¶œ)
- metadata.jsonì€ UTF-8 ì¸ì½”ë”©ìœ¼ë¡œ ì €ì¥
- ëŒ€ìš©ëŸ‰ ë¡œê·¸ ì‹œ íŒŒì¼ í¬ê¸° ê´€ë¦¬ (ì„ íƒì‚¬í•­)

---

## ì˜ˆìƒ ê²°ê³¼ë¬¼

### 1. íŒŒì¼ êµ¬ì¡°

```
src/
â””â”€â”€ utils/
    â”œâ”€â”€ logger.py              # Logger í´ë˜ìŠ¤
    â””â”€â”€ experiment_manager.py  # ExperimentManager í´ë˜ìŠ¤

tests/
â””â”€â”€ utils/
    â”œâ”€â”€ test_logger.py
    â””â”€â”€ test_experiment_manager.py

scripts/
â”œâ”€â”€ find_experiments.py        # ì‹¤í—˜ ê²€ìƒ‰ ìŠ¤í¬ë¦½íŠ¸
â””â”€â”€ aggregate_metrics.py       # í‰ê°€ ì§€í‘œ ì§‘ê³„ ìŠ¤í¬ë¦½íŠ¸

experiments/                   # ì‹¤í—˜ ê²°ê³¼ í´ë”
â””â”€â”€ 20251031/
    â””â”€â”€ 20251031_103015_session_001/
        â”œâ”€â”€ metadata.json
        â”œâ”€â”€ chatbot.log
        â”œâ”€â”€ config.yaml
        â”œâ”€â”€ tools/
        â”œâ”€â”€ database/
        â”œâ”€â”€ prompts/
        â”œâ”€â”€ ui/
        â”œâ”€â”€ outputs/
        â”œâ”€â”€ evaluation/
        â””â”€â”€ debug/                # ì„ íƒ ì‚¬í•­
```

### 2. ì‚¬ìš© ì˜ˆì‹œ

**ExperimentManager ê¸°ë³¸ ì‚¬ìš©:**
```python
from src.utils.experiment_manager import ExperimentManager

with ExperimentManager() as exp:
    exp.logger.write("ì±—ë´‡ ì‹¤í–‰ ì‹œì‘")
    exp.update_metadata(user_query="RAGì— ëŒ€í•´ ì•Œë ¤ì¤˜", difficulty="easy")
    exp.save_output('response.txt', "ë‹µë³€ ë‚´ìš©...")
```

**ë„êµ¬ë³„ Logger:**
```python
with ExperimentManager() as exp:
    tool_logger = exp.get_tool_logger('rag_paper')
    tool_logger.write("ë…¼ë¬¸ ê²€ìƒ‰ ì‹œì‘")
    tool_logger.close()
```

**í‰ê°€ ì§€í‘œ ì €ì¥:**
```python
with ExperimentManager() as exp:
    exp.save_rag_metrics({"recall_at_5": 0.8})
    exp.save_agent_accuracy({"predicted_tool": "rag_paper", "correct": True})
    exp.save_cost_analysis({"total_cost_krw": 30.51})
```
