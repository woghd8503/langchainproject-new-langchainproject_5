# 07. ì„±ëŠ¥ ê°œì„  ì „ëµ

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-30
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±

---

## 1. ìºì‹± ì „ëµ

### 1.1 ìºì‹± ì „ëµ íë¦„

```mermaid
graph TB
    subgraph Request["ğŸ”¸ ìš”ì²­ ì²˜ë¦¬"]
        direction LR
        A[ì‚¬ìš©ì ìš”ì²­<br/>ì§ˆë¬¸ ì…ë ¥] --> B{ìºì‹œ<br/>ì¡´ì¬?}
        B -->|Yes| C[ìºì‹œëœ ë‹µë³€<br/>ì¦‰ì‹œ ë°˜í™˜]
        B -->|No| D[ìƒˆë¡œìš´ ì²˜ë¦¬<br/>LLM/DB í˜¸ì¶œ]
    end

    subgraph Process["ğŸ”¹ ì²˜ë¦¬ & ìºì‹±"]
        direction LR
        D --> E[LLM/DB ì²˜ë¦¬<br/>ì‹œê°„ ì†Œìš”]
        E --> F[ê²°ê³¼ ìºì‹œ<br/>ì €ì¥]
        F --> G[ì‚¬ìš©ìì—ê²Œ<br/>ë‹µë³€ ë°˜í™˜]
    end

    subgraph Benefit["ğŸ”º ì„±ëŠ¥ í–¥ìƒ"]
        direction LR
        H[ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•<br/>50~90%] --> I[API ë¹„ìš© ì ˆê°]
        I --> J[ì‚¬ìš©ì ê²½í—˜ ê°œì„ ]
    end

    Request --> Process
    Process --> Benefit
    C --> Benefit

    %% Subgraph ìŠ¤íƒ€ì¼
    style Request fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style Process fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Benefit fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼
    style A fill:#90caf9,stroke:#1976d2,color:#000
    style B fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style C fill:#66bb6a,stroke:#2e7d32,color:#fff
    style D fill:#64b5f6,stroke:#1976d2,color:#000
    style E fill:#ce93d8,stroke:#7b1fa2,color:#000
    style F fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style G fill:#ab47bc,stroke:#4a148c,color:#fff
    style H fill:#a5d6a7,stroke:#388e3c,color:#000
    style I fill:#81c784,stroke:#2e7d32,color:#000
    style J fill:#66bb6a,stroke:#2e7d32,color:#fff
```

**ìºì‹± ì „ëµ íë¦„ ì„¤ëª…:**
- ì‚¬ìš©ì ìš”ì²­ ì²˜ë¦¬ ì‹œ ìºì‹œ í™œìš©ì„ í†µí•´ ì‘ë‹µ ì‹œê°„ì„ 50~90% ë‹¨ì¶•í•˜ê³  API ë¹„ìš©ì„ ì ˆê°í•˜ëŠ” ì „ëµì„ í‘œí˜„
- ìš”ì²­ ì²˜ë¦¬ ë‹¨ê³„ì—ì„œ ìºì‹œ ì¡´ì¬ ì—¬ë¶€ë¥¼ í™•ì¸í•˜ì—¬ ìºì‹œëœ ë‹µë³€ì´ ìˆìœ¼ë©´ ì¦‰ì‹œ ë°˜í™˜í•˜ê³ , ì—†ìœ¼ë©´ ìƒˆë¡œ ì²˜ë¦¬
- ì²˜ë¦¬ & ìºì‹± ë‹¨ê³„ì—ì„œ LLM/DB í˜¸ì¶œë¡œ ê²°ê³¼ë¥¼ ìƒì„±í•˜ê³  ì´ë¥¼ ìºì‹œì— ì €ì¥í•˜ì—¬ ë™ì¼í•œ ì§ˆë¬¸ì— ì¬ì‚¬ìš©
- ì„±ëŠ¥ í–¥ìƒ ë‹¨ê³„ì—ì„œ ì‘ë‹µ ì‹œê°„ ë‹¨ì¶•, API ë¹„ìš© ì ˆê°, ì‚¬ìš©ì ê²½í—˜ ê°œì„ ì´ë¼ëŠ” 3ê°€ì§€ ì´ì ì„ ì œê³µ

### 1.2 LLM ì‘ë‹µ ìºì‹±

```python
from functools import lru_cache

@lru_cache(maxsize=100)
def cached_llm_call(prompt_hash):
    """LLM ì‘ë‹µ ìºì‹± (ë™ì¼ ì§ˆë¬¸ì— ëŒ€í•œ ì¤‘ë³µ í˜¸ì¶œ ë°©ì§€)"""
    return llm.invoke(prompt)
```

### 1.2 Vector DB ê²€ìƒ‰ ìºì‹±

```python
@lru_cache(maxsize=50)
def cached_similarity_search(query_hash, k):
    """ê²€ìƒ‰ ê²°ê³¼ ìºì‹±"""
    return vectorstore.similarity_search(query, k=k)
```

---

## 2. ë¹„ë™ê¸° ì²˜ë¦¬

### 2.1 ë¹„ë™ê¸° Agent ì‹¤í–‰

```python
import asyncio

async def async_agent_invoke(question, difficulty):
    """ë¹„ë™ê¸° Agent ì‹¤í–‰"""
    result = await agent_executor.ainvoke({
        "question": question,
        "difficulty": difficulty
    })
    return result
```

### 2.2 ë°°ì¹˜ ì„ë² ë”©

```python
# ë°°ì¹˜ë¡œ ì„ë² ë”© ìƒì„± (í•œ ë²ˆì— ì—¬ëŸ¬ ë¬¸ì„œ ì²˜ë¦¬)
embeddings.embed_documents(texts, batch_size=100)
```

---

## 3. ë°ì´í„°ë² ì´ìŠ¤ ìµœì í™”

### 3.1 ì¸ë±ìŠ¤ í™œìš©

```sql
-- ìì£¼ ì¡°íšŒí•˜ëŠ” ì»¬ëŸ¼ì— ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_papers_title ON papers USING GIN (to_tsvector('english', title));
CREATE INDEX idx_papers_category ON papers(category);
```

### 3.2 Connection Pooling

```python
from psycopg2 import pool

connection_pool = pool.SimpleConnectionPool(
    minconn=1,
    maxconn=10,
    **db_config
)
```

---

## 4. ì°¸ê³  ìë£Œ

- Langchain Performance: https://python.langchain.com/docs/guides/performance
- PostgreSQL Tuning: https://www.postgresql.org/docs/current/performance-tips.html
