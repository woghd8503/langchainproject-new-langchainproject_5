# 11. ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

## ë¬¸ì„œ ì •ë³´
- **ì‘ì„±ì¼**: 2025-10-30
- **í”„ë¡œì íŠ¸ëª…**: ë…¼ë¬¸ ë¦¬ë·° ì±—ë´‡ (AI Agent + RAG)
- **íŒ€ëª…**: ì—°ê²°ì˜ ë¯¼ì¡±

---

## 1. ë°ì´í„°ë² ì´ìŠ¤ ì•„í‚¤í…ì²˜

### 1.1 DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ë„

```mermaid
graph TB
    subgraph Papers["ğŸ”¸ ë…¼ë¬¸ ê´€ë¦¬"]
        direction TB
        P[papers í…Œì´ë¸”<br/>paper_id, title, authors<br/>publish_date, abstract]
        P --> PC[paper_chunks<br/>chunk_id, paper_id<br/>chunk_text, embedding]
    end

    subgraph Glossary["ğŸ”¹ ìš©ì–´ì§‘"]
        direction TB
        G[glossary í…Œì´ë¸”<br/>term_id, term<br/>easy_explanation<br/>hard_explanation]
        G --> GE[glossary_embeddings<br/>term_id, embedding]
    end

    subgraph Logs["ğŸ”º ë¡œê·¸ & ëª¨ë‹ˆí„°ë§"]
        direction LR
        QL[query_logs<br/>log_id, user_query<br/>difficulty_mode<br/>tool_used, response_time]
    end

    Papers -.->|ë©”íƒ€ë°ì´í„°| P
    Glossary -.->|ì •ì˜ ì¡°íšŒ| G
    Papers -.->|ë²¡í„° ê²€ìƒ‰| PC
    Glossary -.->|ìœ ì‚¬ ìš©ì–´| GE

    %% Subgraph ìŠ¤íƒ€ì¼
    style Papers fill:#e1f5ff,stroke:#01579b,stroke-width:3px,color:#000
    style Glossary fill:#f3e5f5,stroke:#4a148c,stroke-width:3px,color:#000
    style Logs fill:#e8f5e9,stroke:#1b5e20,stroke-width:3px,color:#000

    %% ë…¸ë“œ ìŠ¤íƒ€ì¼
    style P fill:#90caf9,stroke:#1976d2,color:#000
    style PC fill:#64b5f6,stroke:#1976d2,color:#000
    style G fill:#ce93d8,stroke:#7b1fa2,color:#000
    style GE fill:#ba68c8,stroke:#7b1fa2,color:#fff
    style QL fill:#a5d6a7,stroke:#388e3c,color:#000
```

**DB ìŠ¤í‚¤ë§ˆ êµ¬ì¡°ë„ ì„¤ëª…:**
- ë°ì´í„°ë² ì´ìŠ¤ë¥¼ 3ê°œì˜ ì£¼ìš” ì˜ì—­(ë…¼ë¬¸ ê´€ë¦¬, ìš©ì–´ì§‘, ë¡œê·¸ & ëª¨ë‹ˆí„°ë§)ìœ¼ë¡œ êµ¬ë¶„í•˜ì—¬ ê° í…Œì´ë¸”ì˜ ì—­í• ê³¼ ê´€ê³„ë¥¼ í‘œí˜„
- ë…¼ë¬¸ ê´€ë¦¬ ì˜ì—­ì—ì„œëŠ” papers í…Œì´ë¸”ì´ ë…¼ë¬¸ ë©”íƒ€ë°ì´í„°ë¥¼ ì €ì¥í•˜ê³ , paper_chunks í…Œì´ë¸”ì´ ì²­í¬ ë¶„í• ëœ í…ìŠ¤íŠ¸ì™€ ì„ë² ë”©ì„ ì €ì¥í•˜ì—¬ ë²¡í„° ê²€ìƒ‰ì„ ì§€ì›
- ìš©ì–´ì§‘ ì˜ì—­ì—ì„œëŠ” glossary í…Œì´ë¸”ì´ ìš©ì–´ ì •ì˜ì™€ ë‚œì´ë„ë³„ ì„¤ëª…ì„ ì €ì¥í•˜ê³ , glossary_embeddings í…Œì´ë¸”ì´ ìœ ì‚¬ ìš©ì–´ ê²€ìƒ‰ì„ ìœ„í•œ ì„ë² ë”©ì„ ê´€ë¦¬
- ë¡œê·¸ & ëª¨ë‹ˆí„°ë§ ì˜ì—­ì—ì„œëŠ” query_logs í…Œì´ë¸”ì´ ì‚¬ìš©ì ì§ˆë¬¸, ë‚œì´ë„, ì‚¬ìš©ëœ ë„êµ¬, ì‘ë‹µ ì‹œê°„ ë“±ì„ ê¸°ë¡í•˜ì—¬ ì‹œìŠ¤í…œ ì„±ëŠ¥ ë¶„ì„ì„ ì§€ì›

### 1.2 ì¿¼ë¦¬ íë¦„

```mermaid
sequenceDiagram
    autonumber
    participant App as ì• í”Œë¦¬ì¼€ì´ì…˜
    participant PG as PostgreSQL
    participant VDB as pgvector

    App->>App: ì‚¬ìš©ì ì§ˆë¬¸ ì…ë ¥
    App->>VDB: ì„ë² ë”© ë²¡í„°ë¡œ ë³€í™˜
    VDB->>VDB: ìœ ì‚¬ë„ ê²€ìƒ‰ (Cosine)<br/>Top-K ë¬¸ì„œ ì¶”ì¶œ
    VDB-->>App: chunk_id ë¦¬ìŠ¤íŠ¸ ë°˜í™˜

    App->>PG: paper_id ì¡°íšŒ<br/>FROM paper_chunks
    PG-->>App: paper_id ë°˜í™˜

    App->>PG: ë©”íƒ€ë°ì´í„° ì¡°íšŒ<br/>FROM papers
    PG-->>App: title, authors, year

    App->>App: ì»¨í…ìŠ¤íŠ¸ êµ¬ì„±<br/>LLMì— ì „ë‹¬
```

**ì¿¼ë¦¬ íë¦„ ì„¤ëª…:**
- ì‚¬ìš©ì ì§ˆë¬¸ì´ ì…ë ¥ë˜ë©´ ì• í”Œë¦¬ì¼€ì´ì…˜, PostgreSQL, pgvector ê°„ì˜ ìƒí˜¸ì‘ìš©ì„ í†µí•´ ê´€ë ¨ ë…¼ë¬¸ì„ ê²€ìƒ‰í•˜ëŠ” ì „ì²´ í”„ë¡œì„¸ìŠ¤ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ í‘œí˜„
- ì§ˆë¬¸ì„ ì„ë² ë”© ë²¡í„°ë¡œ ë³€í™˜í•œ í›„ pgvectorì—ì„œ Cosine ìœ ì‚¬ë„ ê¸°ë°˜ìœ¼ë¡œ Top-K ë¬¸ì„œë¥¼ ì¶”ì¶œ
- ê²€ìƒ‰ëœ chunk_idë¡œ paper_chunks í…Œì´ë¸”ì—ì„œ paper_idë¥¼ ì¡°íšŒí•˜ê³ , í•´ë‹¹ paper_idë¡œ papers í…Œì´ë¸”ì—ì„œ ì œëª©, ì €ì, ë…„ë„ ë“±ì˜ ë©”íƒ€ë°ì´í„°ë¥¼ ê°€ì ¸ì˜´
- ìµœì¢…ì ìœ¼ë¡œ ê²€ìƒ‰ëœ ë¬¸ì„œ ë‚´ìš©ê³¼ ë©”íƒ€ë°ì´í„°ë¥¼ ê²°í•©í•˜ì—¬ ì»¨í…ìŠ¤íŠ¸ë¥¼ êµ¬ì„±í•˜ê³  LLMì— ì „ë‹¬í•˜ì—¬ ë‹µë³€ ìƒì„±

### 1.3 ì „ì²´ êµ¬ì¡°

**ì„ íƒ:** PostgreSQL + pgvector í†µí•© ì†”ë£¨ì…˜

**ì´ìœ :**
- ê´€ê³„í˜• ë°ì´í„°ì™€ ë²¡í„° ê²€ìƒ‰ì„ í•˜ë‚˜ì˜ DBì—ì„œ ì²˜ë¦¬
- ìš´ì˜ ë° ìœ ì§€ë³´ìˆ˜ ê°„ì†Œí™”
- Langchainê³¼ ì™„ë²½í•œ í†µí•©

---

## 2. PostgreSQL ìŠ¤í‚¤ë§ˆ

### 2.1 papers í…Œì´ë¸” (ë…¼ë¬¸ ë©”íƒ€ë°ì´í„°)

```sql
CREATE TABLE papers (
    paper_id SERIAL PRIMARY KEY,
    title VARCHAR(500) NOT NULL,
    authors TEXT,                          -- JSON ë˜ëŠ” TEXT í˜•ì‹
    publish_date DATE,
    source VARCHAR(100),                   -- 'arXiv', 'IEEE', 'ACL' ë“±
    url TEXT UNIQUE,                       -- ë…¼ë¬¸ URL (ì¤‘ë³µ ë°©ì§€)
    category VARCHAR(100),                 -- 'cs.AI', 'cs.CL', 'cs.CV' ë“±
    citation_count INT DEFAULT 0,
    abstract TEXT,                         -- ë…¼ë¬¸ ì´ˆë¡
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤ ìƒì„±
CREATE INDEX idx_papers_title ON papers USING GIN (to_tsvector('english', title));
CREATE INDEX idx_papers_category ON papers(category);
CREATE INDEX idx_papers_publish_date ON papers(publish_date DESC);
CREATE INDEX idx_papers_created_at ON papers(created_at DESC);
```

### 2.2 glossary í…Œì´ë¸” (ìš©ì–´ì§‘)

```sql
CREATE TABLE glossary (
    term_id SERIAL PRIMARY KEY,
    term VARCHAR(200) NOT NULL UNIQUE,     -- ìš©ì–´
    definition TEXT NOT NULL,              -- ê¸°ë³¸ ì •ì˜
    easy_explanation TEXT,                 -- Easy ëª¨ë“œ ì„¤ëª…
    hard_explanation TEXT,                 -- Hard ëª¨ë“œ ì„¤ëª…
    category VARCHAR(100),                 -- 'ML', 'NLP', 'CV', 'RL' ë“±
    difficulty_level VARCHAR(20),          -- 'beginner', 'intermediate', 'advanced'
    related_terms TEXT[],                  -- ê´€ë ¨ ìš©ì–´ ë°°ì—´
    examples TEXT,                         -- ì‚¬ìš© ì˜ˆì‹œ
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_glossary_term ON glossary(term);
CREATE INDEX idx_glossary_category ON glossary(category);
CREATE INDEX idx_glossary_difficulty ON glossary(difficulty_level);
```

### 2.3 query_logs í…Œì´ë¸” (ì‚¬ìš©ì ì§ˆì˜ ë¡œê·¸)

```sql
CREATE TABLE query_logs (
    log_id SERIAL PRIMARY KEY,
    user_query TEXT NOT NULL,              -- ì‚¬ìš©ì ì§ˆë¬¸
    difficulty_mode VARCHAR(20),           -- 'easy' ë˜ëŠ” 'hard'
    tool_used VARCHAR(50),                 -- ì‚¬ìš©ëœ ë„êµ¬ëª…
    response TEXT,                         -- ìƒì„±ëœ ì‘ë‹µ
    response_time_ms INT,                  -- ì‘ë‹µ ì‹œê°„ (ë°€ë¦¬ì´ˆ)
    success BOOLEAN DEFAULT TRUE,          -- ì„±ê³µ ì—¬ë¶€
    error_message TEXT,                    -- ì˜¤ë¥˜ ë©”ì‹œì§€ (ìˆëŠ” ê²½ìš°)
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_query_logs_created_at ON query_logs(created_at DESC);
CREATE INDEX idx_query_logs_tool_used ON query_logs(tool_used);
CREATE INDEX idx_query_logs_success ON query_logs(success);
```

---

## 3. pgvector ì»¬ë ‰ì…˜

### 3.1 ì»¬ë ‰ì…˜ êµ¬ì¡°

**3ê°œì˜ pgvector ì»¬ë ‰ì…˜:**

1. **paper_chunks**: ë…¼ë¬¸ ë³¸ë¬¸ ì²­í¬
2. **paper_abstracts**: ë…¼ë¬¸ ì´ˆë¡
3. **glossary_embeddings**: ìš©ì–´ì§‘ ì„ë² ë”©

### 3.2 Langchain PGVector ì„¤ì •

```python
from langchain_postgres.vectorstores import PGVector
from langchain_openai import OpenAIEmbeddings

# ì„ë² ë”© ëª¨ë¸
embeddings = OpenAIEmbeddings(
    model="text-embedding-3-small",
    openai_api_key=os.getenv("OPENAI_API_KEY")
)

# ì—°ê²° ë¬¸ìì—´
CONNECTION_STRING = "postgresql://user:password@localhost:5432/papers"

# 1. ë…¼ë¬¸ ë³¸ë¬¸ ì»¬ë ‰ì…˜
paper_chunks_store = PGVector(
    collection_name="paper_chunks",
    embedding_function=embeddings,
    connection_string=CONNECTION_STRING
)

# 2. ë…¼ë¬¸ ì´ˆë¡ ì»¬ë ‰ì…˜
abstract_store = PGVector(
    collection_name="paper_abstracts",
    embedding_function=embeddings,
    connection_string=CONNECTION_STRING
)

# 3. ìš©ì–´ì§‘ ì»¬ë ‰ì…˜
glossary_store = PGVector(
    collection_name="glossary_embeddings",
    embedding_function=embeddings,
    connection_string=CONNECTION_STRING
)
```

---

## 4. ë°ì´í„° íë¦„

### 4.1 ë…¼ë¬¸ ë°ì´í„° ì €ì¥ íë¦„

```
1. arXiv APIë¡œ ë…¼ë¬¸ ë©”íƒ€ë°ì´í„° ìˆ˜ì§‘
2. PostgreSQL papers í…Œì´ë¸”ì— ë©”íƒ€ë°ì´í„° ì €ì¥ (paper_id ë°˜í™˜)
3. PDF ë‹¤ìš´ë¡œë“œ ë° í…ìŠ¤íŠ¸ ì¶”ì¶œ
4. RecursiveCharacterTextSplitterë¡œ ì²­í¬ ë¶„í• 
5. OpenAI Embeddingsë¡œ ì„ë² ë”© ìƒì„±
6. pgvector paper_chunks ì»¬ë ‰ì…˜ì— ì €ì¥ (paper_id ë©”íƒ€ë°ì´í„° í¬í•¨)
```

### 4.2 ê²€ìƒ‰ íë¦„

```
1. ì‚¬ìš©ì ì§ˆë¬¸ ì„ë² ë”© ìƒì„±
2. pgvector similarity_searchë¡œ ê´€ë ¨ ì²­í¬ ê²€ìƒ‰ (Top-K)
3. ì²­í¬ì˜ paper_idë¡œ PostgreSQL papers í…Œì´ë¸” ì¡°íšŒ
4. ë©”íƒ€ë°ì´í„° (ì œëª©, ì €ì, ë…„ë„) + ì²­í¬ ë‚´ìš©ì„ LLMì— ì „ë‹¬
5. LLMì´ ë‹µë³€ ìƒì„±
```

---

## 5. ìƒ˜í”Œ ë°ì´í„°

### 5.1 papers í…Œì´ë¸”

```sql
INSERT INTO papers (title, authors, publish_date, source, url, category, abstract)
VALUES (
    'Attention Is All You Need',
    'Ashish Vaswani, Noam Shazeer, Niki Parmar, Jakob Uszkoreit, Llion Jones, Aidan N. Gomez, Lukasz Kaiser, Illia Polosukhin',
    '2017-06-12',
    'arXiv',
    'https://arxiv.org/abs/1706.03762',
    'cs.CL',
    'The dominant sequence transduction models are based on complex recurrent or convolutional neural networks...'
);
```

### 5.2 glossary í…Œì´ë¸”

```sql
INSERT INTO glossary (term, definition, easy_explanation, hard_explanation, category, difficulty_level)
VALUES (
    'Attention Mechanism',
    'A technique that allows models to focus on specific parts of the input when generating output.',
    'ì±…ì„ ì½ì„ ë•Œ ì¤‘ìš”í•œ ë¶€ë¶„ì— ì§‘ì¤‘í•˜ëŠ” ê²ƒì²˜ëŸ¼, AIê°€ ì…ë ¥ ë°ì´í„°ì—ì„œ ì¤‘ìš”í•œ ë¶€ë¶„ì— ì§‘ì¤‘í•˜ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.',
    'A weighted sum mechanism that computes attention scores between query and key vectors using dot-product similarity, allowing the model to dynamically focus on relevant input positions during sequence processing.',
    'Deep Learning',
    'intermediate'
);
```

---

## 6. ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸

### 6.1 database/schema.sql

```sql
-- pgvector í™•ì¥ í™œì„±í™”
CREATE EXTENSION IF NOT EXISTS vector;

-- papers í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS papers (
    paper_id SERIAL PRIMARY KEY,
    title VARCHAR(500) NOT NULL,
    authors TEXT,
    publish_date DATE,
    source VARCHAR(100),
    url TEXT UNIQUE,
    category VARCHAR(100),
    citation_count INT DEFAULT 0,
    abstract TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX IF NOT EXISTS idx_papers_title ON papers USING GIN (to_tsvector('english', title));
CREATE INDEX IF NOT EXISTS idx_papers_category ON papers(category);
CREATE INDEX IF NOT EXISTS idx_papers_publish_date ON papers(publish_date DESC);

-- glossary í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS glossary (
    term_id SERIAL PRIMARY KEY,
    term VARCHAR(200) NOT NULL UNIQUE,
    definition TEXT NOT NULL,
    easy_explanation TEXT,
    hard_explanation TEXT,
    category VARCHAR(100),
    difficulty_level VARCHAR(20),
    related_terms TEXT[],
    examples TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX IF NOT EXISTS idx_glossary_term ON glossary(term);
CREATE INDEX IF NOT EXISTS idx_glossary_category ON glossary(category);

-- query_logs í…Œì´ë¸” ìƒì„±
CREATE TABLE IF NOT EXISTS query_logs (
    log_id SERIAL PRIMARY KEY,
    user_query TEXT NOT NULL,
    difficulty_mode VARCHAR(20),
    tool_used VARCHAR(50),
    response TEXT,
    response_time_ms INT,
    success BOOLEAN DEFAULT TRUE,
    error_message TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- ì¸ë±ìŠ¤
CREATE INDEX IF NOT EXISTS idx_query_logs_created_at ON query_logs(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_query_logs_tool_used ON query_logs(tool_used);
```

### 6.2 ì‹¤í–‰

```bash
psql -U your_username -d papers -f database/schema.sql
```

---

## 7. ë°±ì—… ë° ë³µêµ¬

### 7.1 ë°±ì—…

```bash
# ì „ì²´ ë°ì´í„°ë² ì´ìŠ¤ ë°±ì—…
pg_dump -U your_username -d papers -F c -f backup_$(date +%Y%m%d).dump

# íŠ¹ì • í…Œì´ë¸”ë§Œ ë°±ì—…
pg_dump -U your_username -d papers -t papers -F c -f papers_backup.dump
```

### 7.2 ë³µêµ¬

```bash
# ë°ì´í„°ë² ì´ìŠ¤ ë³µì›
createdb papers_restored
pg_restore -U your_username -d papers_restored backup_20251030.dump
```

---

## 8. ì°¸ê³  ìë£Œ

- PostgreSQL ê³µì‹ ë¬¸ì„œ: https://www.postgresql.org/docs/
- pgvector GitHub: https://github.com/pgvector/pgvector
- Langchain PGVector: https://python.langchain.com/docs/integrations/vectorstores/pgvector
