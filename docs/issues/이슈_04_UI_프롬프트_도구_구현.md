## 제목 : Streamlit UI, 프롬프트 템플릿 및 웹검색/파일저장 도구 구현

---

## 📋 작업 개요
**작업 주제:** Streamlit 채팅 UI 개발, 프롬프트 엔지니어링, 웹 검색 도구, 파일 저장 도구 구현
**담당자:** @임예슬
**마감일:** 11/03 24:00

## 📅 기간
- 시작일: 2025-10-28
- 종료일: 2025-11-03

---

## 📌 이슈 목적

사용자와 AI Agent가 상호작용하는 Streamlit 기반 채팅 인터페이스를 개발하고, Easy/Hard 난이도별 프롬프트 템플릿을 설계합니다. 또한 최신 정보 검색을 위한 웹 검색 도구와 대화 내용 저장을 위한 파일 저장 도구를 구현합니다.

**핵심 목표:**
- Streamlit 채팅 인터페이스 구현 (난이도 선택, 대화 이력, 스트리밍)
- Langchain PromptTemplate 기반 Easy/Hard 프롬프트 개발
- Tavily 웹 검색 도구 구현 (search_latest_papers)
- 파일 저장 도구 구현 (save_to_file, save_to_markdown)
- Streamlit 다운로드 버튼 연동

---

## ✅ 작업 항목 체크리스트

### Phase 1: Streamlit UI 기초 개발 (2일)
- [ ] 기본 채팅 인터페이스 구현 (`ui/app.py`)
  - [ ] 페이지 설정 (page_title, page_icon, layout)
  - [ ] 제목 및 설명 표시
  - [ ] 사이드바 난이도 선택 UI (st.selectbox: Easy/Hard)
  - [ ] 세션 상태 초기화 (messages, memory_manager, agent)
  - [ ] 대화 히스토리 표시 (st.chat_message)
  - [ ] 사용자 입력 처리 (st.chat_input)
  - [ ] AI 답변 생성 (Agent.invoke())
  - [ ] ChatMemoryManager 연동
- [ ] 사이드바 추가 기능
  - [ ] 사용 방법 안내
  - [ ] 예시 질문 표시
  - [ ] 대화 초기화 버튼

### Phase 2: 프롬프트 템플릿 개발 (1일)
- [ ] Easy/Hard 모드 프롬프트 구현 (`src/prompts/templates.py`)
  - [ ] EASY_SYSTEM_PROMPT 정의
    - [ ] 전문 용어를 쉬운 말로 설명
    - [ ] 실생활 비유 사용
    - [ ] 수식 최소화
    - [ ] 핵심 아이디어 3가지 이내 요약
  - [ ] HARD_SYSTEM_PROMPT 정의
    - [ ] 기술적 세부사항 및 수식 포함
    - [ ] 알고리즘 시간/공간 복잡도 분석
    - [ ] 관련 논문 비교 (장단점)
    - [ ] 구현 시 고려사항
    - [ ] 최신 연구 동향 연결
  - [ ] ChatPromptTemplate 생성 (SystemMessage + HumanMessage)
  - [ ] get_difficulty_prompt() 함수 구현
- [ ] RAG 프롬프트 구현
  - [ ] RAG_PROMPT_TEMPLATE 정의 (context, question, difficulty 포함)
  - [ ] 출처 명시 규칙 포함
- [ ] FewShotPromptTemplate 구현 (선택 사항)

### Phase 3: 웹 검색 도구 개발 (1일)
- [ ] Tavily 웹 검색 도구 구현 (`src/tools/web_search.py`)
  - [ ] TavilySearchResults 초기화 (max_results=5, search_depth="advanced")
  - [ ] @tool 데코레이터로 search_latest_papers 함수 정의
  - [ ] 검색 쿼리 확장 (AI ML paper 2024 2025 arxiv 추가)
  - [ ] format_web_search_results() 함수 구현 (Markdown 형식)
- [ ] arXiv 검색 도구 구현 (선택 사항)
  - [ ] ArxivLoader 사용
  - [ ] search_arxiv() 함수 정의
- [ ] 웹 검색 노드 구현 (web_search_node, src/agent/nodes.py)

### Phase 4: 파일 저장 도구 개발 (1일)
- [ ] 파일 저장 도구 구현 (`src/tools/file_save.py`)
  - [ ] @tool 데코레이터로 save_to_file 함수 정의
    - [ ] 타임스탬프 기반 파일명 자동 생성
    - [ ] data/outputs 폴더에 저장
  - [ ] @tool 데코레이터로 save_to_markdown 함수 정의
    - [ ] Markdown 형식 포맷팅 (제목, 생성일, 내용, 푸터)
- [ ] Streamlit 다운로드 버튼 연동
  - [ ] 사이드바에 파일 저장 섹션 추가
  - [ ] 저장 내용 선택 (대화 내용 / 마지막 답변만)
  - [ ] st.download_button() 구현
- [ ] 파일 저장 노드 구현 (save_file_node, src/agent/nodes.py)

### Phase 5: 스트리밍 및 최적화 (1일)
- [ ] 스트리밍 응답 구현 (`ui/app_streaming.py`, 선택 사항)
  - [ ] StreamlitCallbackHandler 생성
  - [ ] agent.astream_events() 사용
  - [ ] 실시간 응답 업데이트 (커서 효과 "▌")
- [ ] UI 디자인 개선
  - [ ] 색상 테마 적용
  - [ ] 로딩 애니메이션 (st.spinner)
  - [ ] 성공/오류 메시지 (st.success, st.error)
- [ ] 통합 테스트
  - [ ] 난이도별 답변 품질 확인
  - [ ] 웹 검색 도구 테스트
  - [ ] 파일 저장 기능 테스트

### Phase 6: 문서화 및 테스트 (반나절)
- [ ] 단위 테스트 작성 (`tests/test_tools.py`)
  - [ ] test_web_search()
  - [ ] test_file_save()
- [ ] Logger 클래스 적용
- [ ] 사용자 가이드 작성

---

## 📦 설치/실행 명령어 예시

```bash
# 가상환경 활성화
source .venv/bin/activate

# 필요한 패키지 설치
pip install streamlit langchain langchain-community tavily-python

# 환경변수 설정
export TAVILY_API_KEY="your-tavily-api-key"

# Streamlit 앱 실행
streamlit run ui/app.py

# 스트리밍 버전 실행 (선택 사항)
streamlit run ui/app_streaming.py

# 도구 테스트
python -c "from src.tools.web_search import search_latest_papers; print(search_latest_papers.invoke({'query': 'GPT-4'}))"

# 단위 테스트 실행
pytest tests/test_tools.py -v
```

---

### ⚡️ 참고

**중요 사항:**
1. **난이도 모드**: Easy(초심자용), Hard(전문가용) 프롬프트 명확히 구분
2. **Streamlit 세션 상태**: st.session_state로 messages, agent, memory_manager 관리
3. **웹 검색**: Tavily API 사용 (최신 논문 정보 검색)
4. **파일 저장**: 대화 내용을 txt 또는 md 파일로 저장, 다운로드 버튼 제공
5. **스트리밍**: 실시간 응답 표시로 UX 향상 (선택 사항)

**프롬프트 엔지니어링 팁:**
- Easy 모드: "마치 ~처럼", "예를 들어", "쉽게 말하면" 표현 사용
- Hard 모드: "알고리즘", "시간 복잡도", "수식", "논문 비교" 포함
- RAG 프롬프트: 검색 결과(context)를 명확히 전달, 출처 명시 강조

**Streamlit UI 구조:**
```
사이드바:
- 난이도 선택
- 사용 방법
- 예시 질문
- 파일 저장
- 대화 초기화

메인 화면:
- 제목 및 설명
- 대화 히스토리
- 입력창
```

---

### 유용한 링크

**필수 참고 PRD 문서:**
- [docs/PRD/01_프로젝트_개요.md](../PRD/01_프로젝트_개요.md) - 프로젝트 전체 개요
- [docs/PRD/02_프로젝트_구조.md](../PRD/02_프로젝트_구조.md) - 폴더 구조 (ui/)
- [docs/PRD/05_로깅_시스템.md](../PRD/05_로깅_시스템.md) ⭐ - Logger 사용법
- [docs/PRD/06_실험_추적_관리.md](../PRD/06_실험_추적_관리.md) ⭐ - 실험 폴더 구조
- [docs/PRD/14_LLM_설정.md](../PRD/14_LLM_설정.md) - LLM 선택 및 에러 핸들링
- [docs/PRD/15_프롬프트_엔지니어링.md](../PRD/15_프롬프트_엔지니어링.md) - Easy/Hard 프롬프트 템플릿
- [docs/PRD/16_UI_설계.md](../PRD/16_UI_설계.md) - Streamlit 구현 가이드

**참고 PRD 문서:**
- [docs/PRD/03_브랜치_전략.md](../PRD/03_브랜치_전략.md) - Feature 브랜치
- [docs/PRD/04_일정_관리.md](../PRD/04_일정_관리.md) - 개발 일정
- [docs/PRD/12_AI_Agent_설계.md](../PRD/12_AI_Agent_설계.md) - Agent 연동

**외부 링크:**
- [Streamlit 공식 문서](https://docs.streamlit.io/)
- [Streamlit Chat Elements](https://docs.streamlit.io/library/api-reference/chat)
- [Langchain Prompts](https://python.langchain.com/docs/modules/model_io/prompts/)
- [TavilySearchResults](https://python.langchain.com/docs/integrations/tools/tavily_search/)

## 🔖 추천 라벨

`feature` `ui` `prompt` `tool` `high`

---
